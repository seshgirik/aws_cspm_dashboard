<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise SSO Authentication Flow</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        h2 {
            margin-top: 50px;
            margin-bottom: 20px;
        }
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        .diagram-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 30px;
            margin: 30px 0;
            overflow-x: auto;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .info-card h3 {
            margin-top: 0;
            font-size: 1.3em;
            border-bottom: 2px solid rgba(255,255,255,0.3);
            padding-bottom: 10px;
        }
        .info-card ul {
            list-style: none;
            padding: 0;
        }
        .info-card li {
            padding: 8px 0;
            padding-left: 20px;
            position: relative;
        }
        .info-card li:before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #ffd700;
            font-weight: bold;
        }
        .protocol-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .protocol-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-size: 1.1em;
        }
        .protocol-table td {
            padding: 15px;
            border-bottom: 1px solid #ecf0f1;
        }
        .protocol-table tr:hover {
            background: #f8f9fa;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin-right: 5px;
        }
        .badge-saml {
            background: #e74c3c;
            color: white;
        }
        .badge-oauth {
            background: #3498db;
            color: white;
        }
        .badge-oidc {
            background: #2ecc71;
            color: white;
        }
        .badge-session {
            background: #f39c12;
            color: white;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #ecf0f1;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Enterprise Authentication Flows Comparison</h1>
        <p class="subtitle">SAML 2.0 SSO vs OAuth 2.0 Authorization Code Grant</p>

        <div class="info-grid" style="margin-bottom: 30px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));">
            <div class="info-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                <h3>üìå Flow 1: SAML 2.0 SSO</h3>
                <p style="font-size: 0.9em; opacity: 0.9;">Enterprise Application + Corporate Identity</p>
            </div>
            <div class="info-card" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
                <h3>üìå Flow 2: OIDC</h3>
                <p style="font-size: 0.9em; opacity: 0.9;">OpenID Connect (OAuth 2.0 + Authentication)</p>
            </div>
            <div class="info-card" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                <h3>üìå Flow 3: Hybrid SAML + OAuth</h3>
                <p style="font-size: 0.9em; opacity: 0.9;">Identity Broker + Production Data</p>
            </div>
            <div class="info-card" style="background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);">
                <h3>üìå Flow 4: Client Credentials Grant</h3>
                <p style="font-size: 0.9em; opacity: 0.9;">Machine-to-Machine OAuth (No User Context)</p>
            </div>
        </div>

        <h2 style="color: #e74c3c; border-left: 5px solid #e74c3c; padding-left: 15px; margin-top: 40px;">Flow 1: SAML 2.0 SSO (Enterprise Applications with Corporate Identity)</h2>
        <div style="background: #ffe5e5; border-left: 4px solid #e74c3c; padding: 15px; margin: 20px; border-radius: 4px;">
            <strong>Grant Type:</strong> N/A (SAML is not OAuth-based)<br/>
            <strong>Flow Type:</strong> SAML Web Browser SSO Profile (SP-Initiated or IdP-Initiated)<br/>
            <strong>Protocol:</strong> SAML 2.0 (Security Assertion Markup Language)<br/>
            <strong>Applications:</strong> Enterprise SaaS Applications (Confluence, Jira, Salesforce)<br/>
            <strong>Identity Provider:</strong> Corporate Identity Service (Okta, Azure AD, Auth0)<br/>
            <strong>Use Case:</strong> Enterprise Single Sign-On for workforce applications
        </div>
        
        <div class="diagram-container">
            <div class="mermaid">
sequenceDiagram
    participant User as üë§ User Browser
    participant App as Enterprise App<br/>(Confluence/Jira/Salesforce)<br/>Service Provider (SP)
    participant CorpID as Corporate Identity<br/>(Okta/Azure AD/Auth0)<br/>SAML IdP
    participant Resource as Resource<br/>(Workspace / Project / Record)

    Note over User,Resource: üî¥ SAML 2.0 Web Browser SSO Profile (SP-Initiated)
    rect rgb(255, 235, 238)
    Note over User,Resource: Works for: Enterprise SaaS applications with corporate SSO
    end

    User->>App: 1Ô∏è‚É£ Access Protected Resource<br/>(Project Space / Issue / Record)
    
    Note over App: No valid session found<br/>Redirect to SSO
    
    App->>User: 2Ô∏è‚É£ Redirect to Corporate Identity<br/>SAMLRequest in URL

    User->>CorpID: 3Ô∏è‚É£ GET /sso/saml?SAMLRequest=...<br/>RelayState=<uuid>
    
    Note over CorpID: Corporate Identity Service<br/>Check user session<br/>Verify enterprise credentials
    
    CorpID->>User: 4Ô∏è‚É£ Prompt for corporate credentials<br/>(if not authenticated)
    
    User->>CorpID: 5Ô∏è‚É£ Submit credentials + MFA (Duo/Authenticator)
    
    rect rgb(255, 235, 238)
    Note over CorpID: ‚úÖ SAML AUTHENTICATION<br/>‚úÖ Validate credentials<br/>‚úÖ Multi-factor auth (MFA)<br/>‚úÖ Generate SAML assertion
    end
    
    CorpID->>User: 6Ô∏è‚É£ SAML Response redirect<br/>(POST to /samlconsumer)

    User->>App: 7Ô∏è‚É£ POST /samlconsumer<br/>(SAML Response with assertion)
    
    rect rgb(255, 235, 238)
    Note over App: ‚úÖ SAML VALIDATION<br/>‚úÖ Validate SAML signature<br/>‚úÖ Extract user identity<br/>‚úÖ Create user session
    end
    
    App->>App: 8Ô∏è‚É£ Create session + OAuth token<br/>(for API access)
    
    App->>Resource: 9Ô∏è‚É£ Check RBAC permissions<br/>(space/issue access control)
    
    alt ‚úÖ Has Access
        Resource->>User: üîì Grant access<br/>Load resource
    else ‚ùå No Access
        Resource->>User: üîí Request access<br/>Show authorization page
    end
    
    Note over User,Resource: Subsequent requests use session cookie<br/>SAML assertion establishes identity
            </div>
        </div>

        <div class="info-grid">
            <div class="info-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                <h3>üîë Authentication Phase</h3>
                <ul>
                    <li>Protocol: SAML 2.0</li>
                    <li>Identity Provider: Corporate Identity Service</li>
                    <li>Service Providers: Enterprise Applications</li>
                    <li>MFA: Duo/Microsoft Authenticator/Okta Verify</li>
                    <li>Session: Enterprise-wide SSO</li>
                    <li>Endpoints: /sso/saml (IdP), /samlconsumer (SP)</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                <h3>üé´ Authorization Phase</h3>
                <ul>
                    <li>Protocol: OAuth 2.0 / OIDC (optional)</li>
                    <li>Token Type: JWT Bearer (for API access)</li>
                    <li>Resource: Application-specific identifiers</li>
                    <li>Scope: Project/Workspace access permissions</li>
                    <li>RBAC: Resource-level permissions</li>
                    <li>Examples: Project access, issue management</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #16a085 0%, #138d75 100%);">
                <h3>üõ°Ô∏è Security Layers</h3>
                <ul>
                    <li>Layer 1: Corporate Authentication</li>
                    <li>Layer 2: Multi-Factor Auth (MFA)</li>
                    <li>Layer 3: SAML Assertion Signing</li>
                    <li>Layer 4: OAuth Token Validation</li>
                    <li>Layer 5: Resource-Level RBAC</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                <h3>üîí Security Headers (Production Best Practices)</h3>
                <ul>
                    <li><strong>Strict-Transport-Security:</strong> max-age=31536000 (1 year HSTS)</li>
                    <li><strong>X-Frame-Options:</strong> SAMEORIGIN (clickjacking protection)</li>
                    <li><strong>Content-Security-Policy:</strong> frame-ancestors 'self' (iframe restrictions)</li>
                    <li><strong>X-Content-Type-Options:</strong> nosniff (MIME-sniffing prevention)</li>
                    <li><strong>X-XSS-Protection:</strong> enabled (legacy XSS filter)</li>
                    <li><strong>X-Seraph-LoginReason:</strong> OK (Atlassian auth status)</li>
                    <li><strong>SAML Consumer:</strong> /jira/plugins/servlet/samlconsumer</li>
                    <li><strong>Content-Type:</strong> application/x-www-form-urlencoded (SAML POST)</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                <h3>üîê Application-Specific Security</h3>
                <ul>
                    <li><strong>CSRF Token:</strong> Anti-CSRF protection token</li>
                    <li><strong>Session Cookie:</strong> Session tracking (HttpOnly, Secure)</li>
                    <li><strong>Auth Framework:</strong> Application authentication layer</li>
                    <li><strong>SAML Binding:</strong> HTTP POST (typical size 8-10KB)</li>
                    <li><strong>RelayState:</strong> State parameter for flow continuation</li>
                    <li><strong>Origin Validation:</strong> IdP origin verification</li>
                    <li><strong>Sec-Fetch-Site:</strong> same-site (cross-site protection)</li>
                </ul>
            </div>
        </div>

        <table class="protocol-table">
            <thead>
                <tr>
                    <th>Step</th>
                    <th>Protocol</th>
                    <th>Purpose</th>
                    <th>Data Exchanged</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>1-3</strong></td>
                    <td><span class="badge badge-session">HTTPS</span></td>
                    <td>Initial navigation</td>
                    <td>URL parameters, session cookies</td>
                </tr>
                <tr>
                    <td><strong>4-7</strong></td>
                    <td><span class="badge badge-saml">SAML 2.0</span></td>
                    <td>Enterprise SSO authentication</td>
                    <td>AuthnRequest, SAML Response, user attributes</td>
                </tr>
                <tr>
                    <td><strong>8</strong></td>
                    <td><span class="badge badge-oauth">OAuth 2.0</span> <span class="badge badge-oidc">OIDC</span></td>
                    <td>Token issuance</td>
                    <td>Access token, ID token, refresh token</td>
                </tr>
                <tr>
                    <td><strong>9</strong></td>
                    <td><span class="badge badge-oauth">OAuth 2.0</span></td>
                    <td>Resource authorization</td>
                    <td>ARI (Atlassian Resource Identifier), scopes</td>
                </tr>
                <tr>
                    <td><strong>10</strong></td>
                    <td><span class="badge badge-session">Session</span></td>
                    <td>Access control</td>
                    <td>Permission check, content delivery</td>
                </tr>
            </tbody>
        </table>

        <h2 style="color: #3498db; border-left: 5px solid #3498db; padding-left: 15px; margin-top: 60px;">Flow 2: OIDC Authentication (OAuth 2.0 + OpenID Connect)</h2>
        <p style="color: #7f8c8d; margin-left: 20px;">
            <strong>Use Cases:</strong><br/>
            ‚Ä¢ Generic OIDC: https://xmy.com/login/callback?code=66H8OA25Z9...&state=xN4uTl4xVxfZn0REMsu2zcQqKapXPwgF66MTv<br/>
            ‚Ä¢ HashiCorp Vault: https://vault.company.com/ui/vault/auth/oidc/oidc/callback (via Duo Security SSO)
        </p>
        <div style="background: #e3f2fd; border-left: 4px solid #3498db; padding: 15px; margin: 20px; border-radius: 4px;">
            <strong>Grant Type:</strong> Authorization Code Grant (with PKCE enhancement)<br/>
            <strong>Flow Type:</strong> OIDC Authorization Code Flow<br/>
            <strong>Protocol:</strong> OpenID Connect 1.0 (built on OAuth 2.0)<br/>
            <strong>Required Scope:</strong> <code>openid</code> (+ optional: profile, email, etc.)<br/>
            <strong>HAR Sources:</strong> Generic OIDC pattern + HashiCorp Vault (production environment)
        </div>
        <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px; border-radius: 4px;">
            <strong>‚ö†Ô∏è Important:</strong> OAuth 2.0 alone is for <strong>authorization</strong> (delegated access), NOT authentication (who you are). 
            For login/authentication, this uses <strong>OIDC (OpenID Connect)</strong> - which adds an authentication layer on top of OAuth 2.0.
            OIDC provides an <strong>ID token</strong> (proves identity) + <strong>access token</strong> (accesses resources).
        </div>

        <div class="diagram-container">
            <div class="mermaid">
sequenceDiagram
    participant User as üë§ User Browser
    participant Client as Client App<br/>(xmy.com)
    participant OIDC as OIDC Provider<br/>(Authorization + Authentication Server)
    participant ResourceServer as Resource Server<br/>(API/Backend)

    rect rgb(232, 245, 255)
    Note over User,ResourceServer: üîµ OIDC Authentication (OAuth 2.0 + OpenID Connect)
    Note over User,ResourceServer: Grant Type: AUTHORIZATION CODE GRANT
    Note over User,ResourceServer: Enhancement: PKCE (Proof Key for Code Exchange)
    Note over User,ResourceServer: Required Scope: openid (+ profile, email)
    end

    User->>Client: 1Ô∏è‚É£ Click "Login" / Access Protected Resource
    
    Note over Client: Generate PKCE challenge<br/>Generate random state<br/>Prepare OAuth parameters
    
    Client->>User: 2Ô∏è‚É£ Redirect to OIDC Provider
    
    User->>OIDC: 3Ô∏è‚É£ Authorization Request (GET /authorize)<br/>üìã response_type=code (implies Authorization Code Grant)<br/>üîë scope=openid profile email<br/>üÜî client_id, redirect_uri, state, code_challenge
    
    Note over User,OIDC: ‚öôÔ∏è STEP 3: scope parameter defines permissions<br/>‚öôÔ∏è response_type=code indicates grant type
    
    Note over OIDC: Display login page<br/>(OIDC Provider authenticates user)
    
    OIDC->>User: 4Ô∏è‚É£ Prompt for credentials<br/>(username/password or social login)
    
    User->>OIDC: 5Ô∏è‚É£ Submit credentials + consent
    
    rect rgb(232, 245, 255)
    Note over OIDC: ‚úÖ OIDC AUTHENTICATION (who you are)<br/>‚úÖ Validate credentials (check username/password)<br/>‚úÖ MFA (if required)<br/>‚úÖ User consent (if first time)<br/>‚úÖ Generate authorization code
    end
    
    OIDC->>User: 6Ô∏è‚É£ Redirect to callback<br/>(code + state)
    
    User->>Client: 7Ô∏è‚É£ GET /login/callback<br/>?code=66H8OA25Z9...<br/>&state=xN4uTl4xVxfZn0REMsu2zcQqKapXPwgF66MTv
    
    Note over Client: ‚úÖ Validate state (CSRF protection)<br/>Extract authorization code
    
    Client->>OIDC: 8Ô∏è‚É£ Token Request (POST /token)<br/>üìã grant_type=authorization_code<br/>üé´ code=66H8OA25Z9...<br/>üÜî client_id, client_secret<br/>üîí code_verifier (PKCE), redirect_uri
    
    Note over Client,OIDC: ‚öôÔ∏è STEP 8: grant_type parameter specifies Authorization Code Grant<br/>‚öôÔ∏è This is the token exchange step
    
    rect rgb(232, 245, 255)
    Note over OIDC: ‚úÖ OIDC TOKEN ISSUANCE<br/>‚úÖ Validate authorization code<br/>‚úÖ Verify client credentials<br/>‚úÖ Verify PKCE code_verifier<br/>‚úÖ Validate grant_type parameter<br/>‚úÖ Issue tokens (ID + Access + Refresh)
    end
    
    OIDC->>Client: 9Ô∏è‚É£ Token Response<br/>‚Ä¢ id_token (JWT with user identity) üÜî<br/>‚Ä¢ access_token (for API access) üîë<br/>‚Ä¢ refresh_token (get new tokens) üîÑ
    
    Note over Client: ‚úÖ Validate ID token signature<br/>‚úÖ Extract user info (sub, email, name)<br/>Store tokens securely<br/>Create user session
    
    Client->>OIDC: üîü GET /userinfo<br/>Authorization: Bearer {access_token}
    
    OIDC->>Client: User profile data<br/>(email, name, picture, etc.)
    
    Client->>User: ‚úÖ User authenticated & logged in
    
    Note over User,Client: User session established<br/>ID token proves authentication
    
    Client->>ResourceServer: API Request<br/>Authorization: Bearer {access_token}
    
    Note over ResourceServer: ‚úÖ Validate access token<br/>‚úÖ Check token expiration<br/>‚úÖ Verify scopes<br/>AUTHORIZATION (what you can access)
    
    ResourceServer->>Client: ‚úÖ Protected Resource Data
    
    Client->>User: üéâ Display protected content
    
    Note over User,Client: Subsequent requests:<br/>- ID token for identity proof<br/>- Access token for API calls<br/>- Refresh token when tokens expire
            </div>
        </div>

        <div class="info-grid">
            <div class="info-card" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
                <h3>üîê OIDC Flow Details</h3>
                <ul>
                    <li><strong>Grant Type:</strong> Authorization Code Grant</li>
                    <li><strong>Base Protocol:</strong> OAuth 2.0</li>
                    <li><strong>Extension:</strong> OpenID Connect (OIDC)</li>
                    <li><strong>Purpose:</strong> Authentication + Authorization</li>
                    <li><strong>Scope:</strong> openid (required for OIDC)</li>
                    <li><strong>PKCE:</strong> Code Challenge/Verifier (security enhancement)</li>
                    <li><strong>State:</strong> CSRF Protection Token</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">
                <h3>üé´ Three Token Types</h3>
                <ul>
                    <li><strong>1. ID Token (JWT):</strong> Proves WHO you are üÜî<br/>
                        <small>Contains: sub, email, name, iat, exp</small></li>
                    <li><strong>2. Access Token:</strong> Grants WHAT you can access üîë<br/>
                        <small>Used for API authorization (Bearer token)</small></li>
                    <li><strong>3. Refresh Token:</strong> Gets new tokens üîÑ<br/>
                        <small>Long-lived, used to obtain new access tokens</small></li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                <h3>üìã Key OAuth Parameters by Step</h3>
                <ul>
                    <li><strong>Step 3 (Authorization Request):</strong><br/>
                        ‚Ä¢ response_type=code (grant type indicator)<br/>
                        ‚Ä¢ scope=openid profile email<br/>
                        ‚Ä¢ state, code_challenge (PKCE)</li>
                    <li><strong>Step 7 (Callback):</strong><br/>
                        ‚Ä¢ code: 66H8OA25Z9-5t9f7js3pMUNMDNszk<br/>
                        ‚Ä¢ state: xN4uTl4xVxfZn0REMsu2zcQqKapXPwgF66MTv</li>
                    <li><strong>Step 8 (Token Exchange):</strong><br/>
                        ‚Ä¢ grant_type=authorization_code<br/>
                        ‚Ä¢ code (from step 7)<br/>
                        ‚Ä¢ code_verifier (PKCE proof)</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                <h3>üÜî OIDC vs Plain OAuth 2.0</h3>
                <ul>
                    <li><strong>OAuth 2.0:</strong> Authorization only ‚ùå authentication</li>
                    <li><strong>OIDC:</strong> OAuth 2.0 + authentication layer ‚úÖ</li>
                    <li>OIDC adds <code>openid</code> scope</li>
                    <li>OIDC adds ID token (JWT)</li>
                    <li>OIDC adds /userinfo endpoint</li>
                    <li>OIDC proves user identity</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #16a085 0%, #138d75 100%);">
                <h3>üîí Security Features</h3>
                <ul>
                    <li>PKCE prevents code interception</li>
                    <li>State prevents CSRF attacks</li>
                    <li>Authorization code is single-use</li>
                    <li>ID token signature validation</li>
                    <li>Client authentication required</li>
                    <li>TLS/HTTPS mandatory</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                <h3>‚úÖ Authentication vs Authorization</h3>
                <ul>
                    <li><strong>Authentication (OIDC):</strong><br/>
                        WHO you are - Proves identity via ID token</li>
                    <li><strong>Authorization (OAuth):</strong><br/>
                        WHAT you can access - Grants API access via Access token</li>
                    <li>OIDC = OAuth 2.0 + Identity layer</li>
                    <li>Both use same authorization code flow</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);">
                <h3>üîê HashiCorp Vault Use Case</h3>
                <ul>
                    <li><strong>Application:</strong> HashiCorp Vault (vault.company.com)</li>
                    <li><strong>OIDC Provider:</strong> Duo Security SSO (sso-dbbfec7f.sso.duosecurity.com)</li>
                    <li><strong>Vault Token:</strong> hvs.CAESIM0jccozEHwo2gMz19dRZIli4sQ... (service token)</li>
                    <li><strong>Token Lifetime:</strong> 518400 seconds (6 days)</li>
                    <li><strong>Namespace:</strong> meetpaas, app-secrets, wxt-calling</li>
                    <li><strong>User:</strong> user@company.com (engineer role)</li>
                    <li><strong>Policies:</strong> default, engineer, group-mobius-devops-rw, mobius-approle-access</li>
                    <li><strong>Use Case:</strong> Secrets management with OIDC-based authentication</li>
                </ul>
            </div>
        </div>

        <h2 style="color: #9b59b6; border-left: 5px solid #9b59b6; padding-left: 15px; margin-top: 60px;">Flow 3: Hybrid SAML + OAuth (Identity Broker) with Production Data</h2>
        <div style="background: #f3e5f5; border-left: 4px solid #9b59b6; padding: 15px; margin: 20px; border-radius: 4px;">
            <strong>Authentication:</strong> SAML 2.0 (Enterprise SSO)<br/>
            <strong>Authorization:</strong> OAuth 2.0 Authorization Code Grant<br/>
            <strong>Pattern:</strong> SAML for user authentication ‚Üí OAuth tokens for API authorization<br/>
            <strong>Token Endpoints:</strong> <code>https://idbrokerbts.webex.com/idb/oauth2/v1/access_token</code> (global), <code>https://idbroker-sg.webex.com/idb/oauth2/v1/access_token</code> (Singapore)<br/>
            <strong>Real Data Source:</strong> HAR file from Webex Contact Center production environment (Nov 25, 2025)<br/>
            <strong>Token Lifetime:</strong> 18 hours (access), 59 days (refresh)<br/>
            <strong>Cluster:</strong> PS65 (Singapore), A52D (Global)<br/>
            <strong>Use Case:</strong> Enterprise SSO + Modern API Integration (Enterprise Applications, Collaboration Services)
        </div>

        <div class="diagram-container">
            <div class="mermaid">
sequenceDiagram
    participant User as üë§ User Browser
    participant App as Application/Client<br/>(Resource Consumer)
    participant IDbroker as Identity Broker<br/>(SAML IdP + OAuth AS)
    participant CorpIDP as Corporate Identity<br/>(Enterprise SSO)
    participant API as API/Resource Server<br/>(Protected Resources)

    rect rgb(255, 245, 235)
    Note over User,API: üü† Hybrid Pattern: SAML Authentication ‚Üí OAuth Authorization
    Note over User,API: üî¥ Authentication: SAML 2.0 | üü† Authorization: OAuth 2.0
    end

    User->>App: 1Ô∏è‚É£ Access protected application/API

    Note over App: No valid session<br/>Needs user authentication

    App->>User: 2Ô∏è‚É£ Redirect to IDbroker (SAML SP)

    User->>IDbroker: 3Ô∏è‚É£ SAML Authentication Request

    Note over IDbroker: No session found<br/>Redirect to Enterprise IdP

    IDbroker->>User: 4Ô∏è‚É£ Redirect to Corporate Identity (SAML IdP)

    User->>CorpIDP: 5Ô∏è‚É£ SAML AuthnRequest

    Note over CorpIDP: Display login page

    CorpIDP->>User: 6Ô∏è‚É£ Prompt for credentials + MFA

    User->>CorpIDP: 7Ô∏è‚É£ Submit credentials

    rect rgb(255, 235, 238)
    Note over CorpIDP: ‚úÖ SAML AUTHENTICATION<br/>‚úÖ Validate credentials<br/>‚úÖ Multi-factor auth (MFA)<br/>‚úÖ Generate SAML assertion
    end

    CorpIDP->>User: 8Ô∏è‚É£ SAML Response (redirect)

    User->>IDbroker: 9Ô∏è‚É£ POST SAML Response to IDbroker

    rect rgb(255, 245, 235)
    Note over IDbroker: ‚úÖ SAML ‚Üí OAuth Bridge<br/>‚úÖ Validate SAML assertion<br/>‚úÖ Extract user identity<br/>‚úÖ User is authenticated<br/>üîÑ Now issue OAuth tokens
    end

    IDbroker->>IDbroker: üîü Generate OAuth Tokens<br/>based on SAML identity

    rect rgb(255, 245, 235)
    Note over IDbroker: üü† OAuth 2.0 AUTHORIZATION<br/>‚Ä¢ Generate access_token (JWT)<br/>‚Ä¢ Generate refresh_token<br/>‚Ä¢ Token contains user claims from SAML<br/>‚Ä¢ Token scoped with appropriate permissions
    end

    IDbroker->>App: 1Ô∏è‚É£1Ô∏è‚É£ OAuth Tokens (POST to /idb/oauth2/v1/access_token)<br/>‚Ä¢ access_token (JWT Bearer token)<br/>‚Ä¢ refresh_token<br/>‚Ä¢ scope: spark:kms<br/>‚Ä¢ token_type: Bearer<br/>‚Ä¢ expires_in: 64799 (18 hours)

    Note over App: ‚úÖ Store tokens securely<br/>‚úÖ Create application session<br/>User authenticated via SAML<br/>Authorized via OAuth token

    App->>User: 1Ô∏è‚É£2Ô∏è‚É£ User logged in successfully

    Note over User,App: User session established<br/>OAuth token ready for API calls

    App->>API: 1Ô∏è‚É£3Ô∏è‚É£ API Request<br/>Authorization: Bearer {access_token}

    rect rgb(255, 245, 235)
    Note over API: ‚úÖ OAuth TOKEN VALIDATION<br/>‚úÖ Validate access token<br/>‚úÖ Verify token signature (JWT)<br/>‚úÖ Check expiration<br/>‚úÖ Verify scopes/claims
    end

    API->>App: 1Ô∏è‚É£4Ô∏è‚É£ Protected resource data

    App->>User: 1Ô∏è‚É£5Ô∏è‚É£ Display data

    Note over User,API: Subsequent API calls use Bearer token<br/>Token refresh uses refresh_token

    alt Access Token Expires
        App->>IDbroker: POST /token<br/>grant_type=refresh_token<br/>refresh_token={refresh_token}
        IDbroker->>App: New access_token + refresh_token
    else Token Invalid/Expired
        App->>User: Redirect to re-authenticate (SAML flow)
    end
            </div>
        </div>

        <div class="info-grid">
            <div class="info-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                <h3>üîë Phase 1: SAML Authentication</h3>
                <ul>
                    <li><strong>Purpose:</strong> Prove WHO you are</li>
                    <li><strong>Protocol:</strong> SAML 2.0</li>
                    <li><strong>IdP:</strong> Corporate Identity (Enterprise)</li>
                    <li><strong>Output:</strong> SAML assertion with user identity</li>
                    <li><strong>Steps:</strong> 1-9 (Enterprise SSO)</li>
                    <li><strong>MFA:</strong> ‚úÖ Yes (Duo/Microsoft Authenticator)</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
                <h3>üé´ Phase 2: OAuth Token Issuance</h3>
                <ul>
                    <li><strong>Purpose:</strong> Grant WHAT you can access</li>
                    <li><strong>Protocol:</strong> OAuth 2.0</li>
                    <li><strong>Token Server:</strong> Identity Broker</li>
                    <li><strong>Output:</strong> Access token + Refresh token</li>
                    <li><strong>Steps:</strong> 10-11 (Token generation)</li>
                    <li><strong>Token Type:</strong> JWT Bearer token</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #16a085 0%, #138d75 100%);">
                <h3>üîí Phase 3: API Authorization</h3>
                <ul>
                    <li><strong>Purpose:</strong> Access protected resources</li>
                    <li><strong>Method:</strong> Bearer token authentication</li>
                    <li><strong>Validation:</strong> JWT signature + expiry</li>
                    <li><strong>Steps:</strong> 13-15 (API calls)</li>
                    <li><strong>Refresh:</strong> ‚úÖ Yes (refresh_token grant)</li>
                    <li><strong>Stateless:</strong> ‚úÖ Token contains claims</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                <h3>üíé Why This Hybrid Approach?</h3>
                <ul>
                    <li>‚úÖ Enterprise SSO (SAML) for authentication</li>
                    <li>‚úÖ Modern APIs (OAuth) for authorization</li>
                    <li>‚úÖ Token-based stateless API access</li>
                    <li>‚úÖ Works with mobile & web apps</li>
                    <li>‚úÖ Centralized identity management</li>
                    <li>‚úÖ Fine-grained API permissions</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                <h3>üìã IDbroker Role</h3>
                <ul>
                    <li><strong>SAML Service Provider (SP):</strong> Receives SAML assertions</li>
                    <li><strong>OAuth Authorization Server:</strong> Issues OAuth tokens</li>
                    <li><strong>Token Transformer:</strong> SAML identity ‚Üí OAuth claims</li>
                    <li><strong>Session Manager:</strong> Manages user sessions</li>
                    <li><strong>Token Validator:</strong> Validates JWT tokens</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                <h3>üéØ OAuth Token Contents (JWT Claims)</h3>
                <ul>
                    <li><strong>sub:</strong> User ID (from SAML)</li>
                    <li><strong>email:</strong> User email (from SAML)</li>
                    <li><strong>name:</strong> Display name (from SAML)</li>
                    <li><strong>scope:</strong> API permissions (e.g., spark:kms)</li>
                    <li><strong>cluster:</strong> Webex cluster (e.g., A52D)</li>
                    <li><strong>iss:</strong> Issuer (IDbroker)</li>
                    <li><strong>exp:</strong> Expiration time</li>
                    <li><strong>iat:</strong> Issued at</li>
                    <li><strong>private:</strong> Encrypted user context</li>
                </ul>
            </div>
        </div>

        <div style="background: #fff3cd; border-left: 4px solid #9b59b6; padding: 20px; margin: 30px 0; border-radius: 4px;">
            <h3 style="color: #8e44ad; margin-top: 0;">üîê Production Identity Broker Token Response</h3>
            <p><strong>Endpoint:</strong> <code>POST https://idbrokerbts.webex.com/idb/oauth2/v1/access_token</code></p>
            <div style="background: #2c3e50; color: #ecf0f1; padding: 20px; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 0.9em; overflow-x: auto; margin-top: 15px;">
<pre style="margin: 0; color: #ecf0f1;">{
    <span style="color: #e74c3c;">"scope"</span>: <span style="color: #2ecc71;">"spark:kms"</span>,
    <span style="color: #e74c3c;">"expires_in"</span>: <span style="color: #3498db;">64799</span>,
    <span style="color: #e74c3c;">"token_type"</span>: <span style="color: #2ecc71;">"Bearer"</span>,
    <span style="color: #e74c3c;">"access_token"</span>: <span style="color: #2ecc71;">"eyJhbGciOiJSUzI1NiJ9.eyJjbHVzdGVyIjoiQTUyRCIsInByaXZhdGUiOiJleUpqZEhraU9pSktWMVFpTENKbGJtTWlPaUpCTVRJNFEwSkRMVWhUTWpVMklpd2lZV3hqxFqzAkn9HP9wJs7TKnwlpEs-2oJfTZ-WHAwQUkQFLfrlteU-U_LBN4T1lubPVJ-2CjNStAJimB911bg"</span>
}</pre>
            </div>
            <div style="margin-top: 20px; background: white; padding: 15px; border-radius: 4px;">
                <h4 style="margin-top: 0; color: #8e44ad;">üìã Token Response Fields:</h4>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li><strong>scope:</strong> <code>spark:kms</code> - Permission to access Webex Key Management Service (KMS) APIs</li>
                    <li><strong>expires_in:</strong> <code>64799</code> seconds (‚âà18 hours) - Token lifetime</li>
                    <li><strong>token_type:</strong> <code>Bearer</code> - Used in Authorization header: <code>Authorization: Bearer {access_token}</code></li>
                    <li><strong>access_token:</strong> JWT token with three parts (header.payload.signature)
                        <ul style="margin-top: 5px;">
                            <li><strong>Header:</strong> <code>eyJhbGciOiJSUzI1NiJ9</code> ‚Üí <code>{"alg":"RS256"}</code></li>
                            <li><strong>Payload:</strong> Contains <code>cluster</code> (A52D), <code>private</code> (encrypted), user claims from SAML</li>
                            <li><strong>Signature:</strong> RSA-256 signed by IDbroker private key</li>
                        </ul>
                    </li>
                </ul>
            </div>
            <div style="margin-top: 15px; background: #e8f5e9; padding: 15px; border-radius: 4px; border-left: 3px solid #4caf50;">
                <strong>üí° Usage Example:</strong>
                <pre style="background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 4px; margin-top: 10px; overflow-x: auto;"><code>GET https://api.webex.com/v1/kms/keys
Authorization: Bearer eyJhbGciOiJSUzI1NiJ9.eyJjbHVzdGVyIjoiQTUyRCIs...
Content-Type: application/json</code></pre>
            </div>
        </div>

        <div style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 20px; margin: 30px 0; border-radius: 4px;">
            <h3 style="color: #2e7d32; margin-top: 0;">üí° Key Benefits of SAML + OAuth Hybrid</h3>
            <p><strong>Best of Both Worlds:</strong></p>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li><strong>SAML Authentication:</strong> Leverages existing enterprise SSO infrastructure (Corporate Identity, Okta, Azure AD)</li>
                <li><strong>OAuth Authorization:</strong> Modern token-based API access for microservices and mobile apps</li>
                <li><strong>Single Sign-On:</strong> User authenticates once via SAML, gets OAuth tokens for multiple APIs</li>
                <li><strong>Token Refresh:</strong> Long-lived sessions without re-authentication via refresh tokens (18 hours access, 59 days refresh)</li>
                <li><strong>Stateless APIs:</strong> JWT tokens contain all necessary claims, no session storage needed</li>
                <li><strong>Fine-Grained Access:</strong> OAuth scopes provide granular API permissions (16+ scopes in production)</li>
                <li><strong>Production Performance:</strong> Token exchange completes in ~227ms (from real HAR trace)</li>
            </ul>
            <p style="margin-top: 15px; background: white; padding: 15px; border-radius: 4px;">
                <strong>Example Flow:</strong> Employee logs in to Enterprise Application ‚Üí SAML authenticates via Corporate Identity ‚Üí IDbroker issues OAuth token with cluster info ‚Üí App uses token to call multiple APIs (Collaboration, etc.) ‚Üí No password re-entry needed for 18 hours
            </p>
        </div>

        <h3 style="color: #16a085; margin-top: 40px; padding: 15px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 8px;">üì¶ Real Production Token Exchange (HAR Trace from Webex Contact Center)</h3>
        <div style="background: #e8f5e9; border-left: 4px solid #16a085; padding: 15px; margin: 20px; border-radius: 4px;">
            <strong>Source:</strong> HAR File - Production environment trace<br/>
            <strong>Captured Step:</strong> Step 11 from Flow 3 above (OAuth Token Exchange)<br/>
            <strong>Token Endpoint:</strong> <code>https://idbroker-sg.webex.com/idb/oauth2/v1/access_token</code><br/>
            <strong>Application:</strong> Enterprise Application Desktop<br/>
            <strong>Date:</strong> November 25, 2025 02:54:50 GMT<br/>
            <strong>Cluster:</strong> Singapore (PS65)<br/>
            <strong>Processing Time:</strong> 227ms server + 730ms total<br/>
            <strong>This shows:</strong> Real-world timing and token contents from production OAuth flow
        </div>

        <div class="info-grid" style="margin-top: 30px;">
            <div class="info-card" style="background: linear-gradient(135deg, #16a085 0%, #138d75 100%);">
                <h3>üì¶ HAR File Token Exchange Request</h3>
                <ul>
                    <li><strong>Method:</strong> POST</li>
                    <li><strong>URL:</strong> https://idbroker-sg.webex.com/idb/oauth2/v1/access_token</li>
                    <li><strong>Query Parameters:</strong>
                        <ul style="margin-top: 5px;">
                            <li>grant_type=authorization_code</li>
                            <li>redirect_uri=https://desktop.company.com</li>
                            <li>code=ZTc1YjYyYzUtMjI4Ni00OTYzLWE5MmMtYjVmZmE4MmNhMDUwY2Y5OTZlMTYtNzFh_PS65_...</li>
                            <li>self_contained_token=true</li>
                        </ul>
                    </li>
                    <li><strong>Response Status:</strong> 200 OK</li>
                    <li><strong>Response Time:</strong> 730ms total (227ms wait)</li>
                    <li><strong>Server:</strong> istio-envoy</li>
                    <li><strong>TrackingID:</strong> ROUTERGW_a4d84e23-1a61-429e-976f-8e941cf7dc96</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #27ae60 0%, #229954 100%);">
                <h3>üé´ Real Token Response (from HAR)</h3>
                <ul>
                    <li><strong>access_token:</strong> JWT (eyJhbGciOiJSUzI1NiJ9...)<br/>
                        <small>RS256 signed, contains cluster=PS65</small></li>
                    <li><strong>refresh_token:</strong> RTZlMGM0OWYt...<br/>
                        <small>Valid for 59 days</small></li>
                    <li><strong>expires_in:</strong> 64799 seconds (‚âà18 hours)</li>
                    <li><strong>token_type:</strong> Bearer</li>
                    <li><strong>scope:</strong> Multiple permissions:
                        <ul style="margin-top: 5px; font-size: 0.85em;">
                            <li>spark:calls_write/read</li>
                            <li>spark:telephony_config_write/read</li>
                            <li>cloud-contact-center-digital:read/write</li>
                            <li>spark:kms (Key Management)</li>
                            <li>spark:webrtc_calling</li>
                            <li>Identity:SCIM</li>
                            <li>cjp:config_read/write</li>
                            <li>webex-squared:kms_bind/write/read</li>
                        </ul>
                    </li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                <h3>üîç JWT Token Claims (Decoded)</h3>
                <ul>
                    <li><strong>Header:</strong> {"alg":"RS256"}</li>
                    <li><strong>Payload Claims:</strong>
                        <ul style="margin-top: 5px;">
                            <li><strong>cluster:</strong> "PS65" (Singapore)</li>
                            <li><strong>iss:</strong> https://idbroker-sg.webex.com/idb</li>
                            <li><strong>org_id:</strong> 354d6f89-da4f-43ce-b95d-26ee827b45b2</li>
                            <li><strong>cis_uuid:</strong> 1101cc6b-ea81-433e-a32a-dc972e80e12a</li>
                            <li><strong>realm:</strong> 354d6f89-da4f-43ce-b95d-26ee827b45b2</li>
                            <li><strong>client_id:</strong> Ce721947...</li>
                            <li><strong>token_type:</strong> Bearer</li>
                            <li><strong>user_type:</strong> user</li>
                            <li><strong>amr:</strong> ["pwd"] (password authentication)</li>
                            <li><strong>reference_id:</strong> 82b5369e-fc1b-4de0-8627-0ad941e92831</li>
                            <li><strong>exp:</strong> 1764104089170 (expiration timestamp)</li>
                            <li><strong>private:</strong> Encrypted user context (JWE)</li>
                        </ul>
                    </li>
                    <li><strong>Signature:</strong> RSA-256 signed</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                <h3>üîí Security Headers (from HAR)</h3>
                <ul>
                    <li><strong>strict-transport-security:</strong> max-age=31536000</li>
                    <li><strong>x-content-type-options:</strong> nosniff</li>
                    <li><strong>x-frame-options:</strong> DENY</li>
                    <li><strong>x-xss-protection:</strong> 1; mode=block</li>
                    <li><strong>cache-control:</strong> no-cache, no-store</li>
                    <li><strong>referrer-policy:</strong> no-referrer-when-downgrade</li>
                    <li><strong>CORS Headers:</strong>
                        <ul style="margin-top: 5px;">
                            <li>access-control-allow-credentials: true</li>
                            <li>access-control-allow-origin: https://desktop.company.com</li>
                            <li>access-control-allow-methods: POST, PUT, PATCH, HEAD, GET...</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>

        <div style="background: #fff3cd; border-left: 4px solid #f39c12; padding: 20px; margin: 30px 0; border-radius: 4px;">
            <h3 style="color: #e67e22; margin-top: 0;">üí° Key Insights from HAR Trace</h3>
            <p><strong>What the HAR File Reveals:</strong></p>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li><strong>Production OAuth Flow:</strong> Real authorization code grant captured from live enterprise application</li>
                <li><strong>Token Exchange Timing:</strong> 227ms server processing, 730ms total - shows real-world latency</li>
                <li><strong>Comprehensive Scopes:</strong> 16+ different scopes for calls, telephony config, KMS, contact center, and identity management</li>
                <li><strong>Long Token Lifetime:</strong> 18-hour access tokens and 59-day refresh tokens minimize re-authentication</li>
                <li><strong>Regional Deployment:</strong> Singapore cluster (PS65) with dedicated idbroker-sg endpoint</li>
                <li><strong>JWT Self-Contained:</strong> Token includes encrypted private context, cluster info, org/user identifiers</li>
                <li><strong>Enterprise Security:</strong> HSTS, CSP headers, CORS restrictions, XSS protection all enforced</li>
                <li><strong>Istio Service Mesh:</strong> Traffic routed through istio-envoy proxy with TrackingID for observability</li>
            </ul>
            <p style="margin-top: 15px; background: white; padding: 15px; border-radius: 4px;">
                <strong>Comparison to Flow 3:</strong> This HAR trace shows the <em>token exchange step (step 11)</em> from Flow 3, where the application trades the authorization code for OAuth tokens after SAML authentication completes.
            </p>
        </div>

        <h2 style="color: #9b59b6; border-left: 5px solid #9b59b6; padding-left: 15px; margin-top: 60px;">üìä Comparison: SAML vs OIDC vs Hybrid (SAML + OAuth)</h2>

        <table class="protocol-table">
            <thead>
                <tr>
                    <th>Aspect</th>
                    <th>SAML 2.0 SSO</th>
                    <th>OIDC (OAuth 2.0 + OpenID Connect)</th>
                    <th>Hybrid (SAML + OAuth)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Grant Type</strong></td>
                    <td>‚ùå N/A (SAML is not OAuth-based)</td>
                    <td>‚úÖ Authorization Code Grant (with PKCE)</td>
                    <td>‚ùå N/A for auth | ‚úÖ Token exchange for authorization</td>
                </tr>
                <tr>
                    <td><strong>Flow Type</strong></td>
                    <td>SAML Web Browser SSO Profile</td>
                    <td>OIDC Authorization Code Flow</td>
                    <td>SAML for auth ‚Üí OAuth token issuance</td>
                </tr>
                <tr>
                    <td><strong>Primary Use Case</strong></td>
                    <td>Enterprise Single Sign-On (SSO)</td>
                    <td>Modern authentication + API authorization</td>
                    <td>Enterprise SSO + Modern API integration</td>
                </tr>
                <tr>
                    <td><strong>Authentication</strong></td>
                    <td>‚úÖ Yes (SAML assertion proves identity)</td>
                    <td>‚úÖ Yes (ID token proves identity)</td>
                    <td>‚úÖ Yes (SAML assertion proves identity)</td>
                </tr>
                <tr>
                    <td><strong>Authorization</strong></td>
                    <td>Limited (via attributes/roles in assertion)</td>
                    <td>‚úÖ Yes (access token with scopes)</td>
                    <td>‚úÖ Yes (OAuth access token with scopes)</td>
                </tr>
                <tr>
                    <td><strong>Token Format</strong></td>
                    <td>SAML assertion (XML signed document)</td>
                    <td>ID token (JWT) + Access token (JWT/opaque)</td>
                    <td>SAML assertion ‚Üí OAuth tokens (JWT)</td>
                </tr>
                <tr>
                    <td><strong>API Access Method</strong></td>
                    <td>‚ùå Not designed for APIs</td>
                    <td>‚úÖ Bearer token (Authorization header)</td>
                    <td>‚úÖ Bearer token (Authorization header)</td>
                </tr>
                <tr>
                    <td><strong>Token Refresh</strong></td>
                    <td>‚ùå No (requires re-authentication)</td>
                    <td>‚úÖ Yes (refresh tokens)</td>
                    <td>‚úÖ Yes (refresh tokens)</td>
                </tr>
                <tr>
                    <td><strong>Mobile Support</strong></td>
                    <td>‚ùå Poor (browser redirects, XML parsing)</td>
                    <td>‚úÖ Excellent (native apps, PKCE, AppAuth)</td>
                    <td>‚úÖ Good (OAuth tokens work with mobile)</td>
                </tr>
                <tr>
                    <td><strong>Stateless API Calls</strong></td>
                    <td>‚ùå Session-based</td>
                    <td>‚úÖ Yes (JWT with claims)</td>
                    <td>‚úÖ Yes (JWT with claims)</td>
                </tr>
                <tr>
                    <td><strong>Components</strong></td>
                    <td>IdP + SP</td>
                    <td>Authorization Server + Client</td>
                    <td>SAML IdP + IDbroker (SP + OAuth AS) + Client</td>
                </tr>
                <tr>
                    <td><strong>Implementation</strong></td>
                    <td>Single protocol (SAML only)</td>
                    <td>Single protocol (OIDC/OAuth only)</td>
                    <td>Two protocols (SAML ‚Üí OAuth bridge)</td>
                </tr>
                <tr>
                    <td><strong>Enterprise SSO</strong></td>
                    <td>‚úÖ Excellent (native support)</td>
                    <td>‚ö†Ô∏è Good (with enterprise IdP support)</td>
                    <td>‚úÖ Excellent (leverages existing SAML)</td>
                </tr>
                <tr>
                    <td><strong>Microservices</strong></td>
                    <td>‚ùå Poor (not designed for distributed)</td>
                    <td>‚úÖ Excellent (token-based, stateless)</td>
                    <td>‚úÖ Excellent (OAuth tokens for services)</td>
                </tr>
                <tr>
                    <td><strong>Complexity</strong></td>
                    <td>High (XML, signatures, certificates)</td>
                    <td>Medium (JSON, JWT validation)</td>
                    <td>High (both SAML and OAuth)</td>
                </tr>
                <tr>
                    <td><strong>Example Services</strong></td>
                    <td>Google Workspace, AWS SSO</td>
                    <td>Auth0, GitHub, Google Sign-In</td>
                    <td>Identity Broker, Atlassian, Salesforce</td>
                </tr>
                <tr>
                    <td><strong>Best For</strong></td>
                    <td>
                        ‚Ä¢ Enterprise web SSO<br/>
                        ‚Ä¢ Workforce authentication<br/>
                        ‚Ä¢ B2B integrations
                    </td>
                    <td>
                        ‚Ä¢ Modern authentication<br/>
                        ‚Ä¢ Consumer apps<br/>
                        ‚Ä¢ Mobile/native apps<br/>
                        ‚Ä¢ API authorization
                    </td>
                    <td>
                        ‚Ä¢ Enterprise with APIs<br/>
                        ‚Ä¢ Legacy SAML + Modern apps<br/>
                        ‚Ä¢ Microservices architecture<br/>
                        ‚Ä¢ Mobile + Web + APIs
                    </td>
                </tr>
            </tbody>
        </table>
                <tr>
                    <td><strong>Protocol Format</strong></td>
                    <td>XML-based (SAML assertions)</td>
                    <td>JSON-based (JWT tokens)</td>
                    <td>XML (SAML) ‚Üí JSON (OAuth tokens)</td>
                </tr>
                <tr>
                    <td><strong>Authentication</strong></td>
                    <td>‚úÖ Yes (SAML assertion proves identity)</td>
                    <td>‚úÖ Yes (ID token proves identity)</td>
                </tr>
                <tr>
                    <td><strong>Authorization</strong></td>
                    <td>Limited (via attributes/roles in assertion)</td>
                    <td>‚úÖ Yes (access token with scopes)</td>
                </tr>
                <tr>
                    <td><strong>Token/Assertion Format</strong></td>
                    <td>SAML assertion (XML signed document)</td>
                    <td>ID token (JWT) + Access token (JWT/opaque)</td>
                </tr>
                <tr>
                    <td><strong>Identity Proof</strong></td>
                    <td>SAML Response with attributes</td>
                    <td>ID Token (JWT) with claims (sub, email, name)</td>
                </tr>
                <tr>
                    <td><strong>API Access</strong></td>
                    <td>‚ùå Not designed for APIs</td>
                    <td>‚úÖ Access token for Bearer authentication</td>
                </tr>
                <tr>
                    <td><strong>Flow Initiation</strong></td>
                    <td>SP-initiated or IdP-initiated</td>
                    <td>Always client-initiated (authorization request)</td>
                </tr>
                <tr>
                    <td><strong>User Consent</strong></td>
                    <td>Not typically required (enterprise trust)</td>
                    <td>‚úÖ Required (explicit consent screen)</td>
                </tr>
                <tr>
                    <td><strong>Mobile Support</strong></td>
                    <td>‚ùå Poor (browser redirects, XML parsing)</td>
                    <td>‚úÖ Excellent (native apps, PKCE, AppAuth)</td>
                </tr>
                <tr>
                    <td><strong>Token Refresh</strong></td>
                    <td>‚ùå No (requires re-authentication)</td>
                    <td>‚úÖ Yes (refresh tokens)</td>
                </tr>
                <tr>
                    <td><strong>Scopes/Granular Permissions</strong></td>
                    <td>‚ùå Limited (coarse-grained roles)</td>
                    <td>‚úÖ Yes (fine-grained scopes: openid, profile, email)</td>
                </tr>
                <tr>
                    <td><strong>CSRF Protection</strong></td>
                    <td>RelayState parameter</td>
                    <td>State parameter + PKCE</td>
                </tr>
                <tr>
                    <td><strong>Transport</strong></td>
                    <td>Browser redirects (HTTP POST/GET)</td>
                    <td>Browser redirects + Backend token exchange (POST /token)</td>
                </tr>
                <tr>
                    <td><strong>Required Scope</strong></td>
                    <td>N/A (SAML has no scopes)</td>
                    <td><code>openid</code> scope (mandatory for OIDC)</td>
                </tr>
                <tr>
                    <td><strong>User Info Endpoint</strong></td>
                    <td>‚ùå No (attributes in SAML assertion)</td>
                    <td>‚úÖ Yes (/userinfo endpoint)</td>
                </tr>
                <tr>
                    <td><strong>Typical Use</strong></td>
                    <td>Enterprise web SSO (Okta, Azure AD, Microsoft)</td>
                    <td>Consumer apps, mobile apps, modern web apps, SPAs</td>
                </tr>
                <tr>
                    <td><strong>Example URL (Callback)</strong></td>
                    <td>https://app.com/saml/acs<br/>(POST with SAMLResponse)</td>
                    <td>https://xmy.com/login/callback<br/>?code=66H8OA25Z9...&state=xN4uTl4x...</td>
                </tr>
                <tr>
                    <td><strong>Complexity</strong></td>
                    <td>High (XML, signatures, certificates)</td>
                    <td>Medium (JSON, JWT validation, simpler)</td>
                </tr>
                <tr>
                    <td><strong>Session Management</strong></td>
                    <td>‚úÖ Built-in (Single Logout - SLO)</td>
                    <td>Application-managed (token revocation, RP-initiated logout)</td>
                </tr>
                <tr>
                    <td><strong>Standards Body</strong></td>
                    <td>OASIS (XML-based standards)</td>
                    <td>OpenID Foundation (built on OAuth 2.0)</td>
                </tr>
                <tr>
                    <td><strong>Best For</strong></td>
                    <td>
                        ‚Ä¢ Enterprise SSO<br/>
                        ‚Ä¢ Workforce authentication<br/>
                        ‚Ä¢ Web applications<br/>
                        ‚Ä¢ B2B integrations
                    </td>
                    <td>
                        ‚Ä¢ Modern authentication<br/>
                        ‚Ä¢ Consumer login (Google, Facebook)<br/>
                        ‚Ä¢ Mobile/native apps<br/>
                        ‚Ä¢ Single-page apps (SPAs)<br/>
                        ‚Ä¢ API authorization
                    </td>
                </tr>
            </tbody>
        </table>

        <h2 style="color: #e67e22; border-left: 5px solid #e67e22; padding-left: 15px; margin-top: 60px;">üîÄ When to Use Which?</h2>

        <div class="info-grid">
            <div class="info-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                <h3>Use SAML 2.0 When:</h3>
                <ul>
                    <li>‚úÖ Enterprise workforce SSO only</li>
                    <li>‚úÖ Web-based applications only</li>
                    <li>‚úÖ Existing IdP supports SAML (Okta, Azure AD)</li>
                    <li>‚úÖ Need centralized session management</li>
                    <li>‚úÖ No mobile app requirements</li>
                    <li>‚úÖ No API integration needed</li>
                    <li>‚úÖ B2B partner integrations</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
                <h3>Use OIDC (OpenID Connect) When:</h3>
                <ul>
                    <li>‚úÖ Modern authentication needs</li>
                    <li>‚úÖ Consumer-facing applications</li>
                    <li>‚úÖ Mobile or native applications</li>
                    <li>‚úÖ Single-page apps (SPAs)</li>
                    <li>‚úÖ Need API authorization + authentication</li>
                    <li>‚úÖ Social login (Google, Facebook, GitHub)</li>
                    <li>‚úÖ Microservices authentication</li>
                    <li>‚úÖ No existing SAML infrastructure</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                <h3>Use Hybrid (SAML + OAuth) When:</h3>
                <ul>
                    <li>‚úÖ Existing SAML SSO infrastructure</li>
                    <li>‚úÖ Need modern API integration</li>
                    <li>‚úÖ Mobile apps + Enterprise SSO</li>
                    <li>‚úÖ Microservices architecture</li>
                    <li>‚úÖ Token-based stateless APIs</li>
                    <li>‚úÖ Multiple backend services</li>
                    <li>‚úÖ Can't replace SAML (compliance/policy)</li>
                    <li>‚úÖ Best of both worlds approach</li>
                </ul>
            </div>
        </div>

        <div style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 20px; margin: 30px 0; border-radius: 4px;">
            <h3 style="color: #2e7d32; margin-top: 0;">üí° Key Insight: OAuth 2.0 vs OIDC</h3>
            <p style="margin: 10px 0;"><strong>OAuth 2.0 alone:</strong> ‚ùå NOT for authentication. It's for <strong>authorization</strong> (delegated access to resources). You get an access token to call APIs, but it doesn't prove WHO you are.</p>
            <p style="margin: 10px 0;"><strong>OIDC (OAuth 2.0 + OpenID Connect):</strong> ‚úÖ For authentication AND authorization. Adds an <strong>ID token</strong> that proves identity (like a digital passport). When you see "Login with Google/GitHub", that's OIDC, not plain OAuth 2.0.</p>
            <p style="margin: 10px 0; background: white; padding: 15px; border-radius: 4px;">
                <strong>The callback URL</strong> <code>https://xmy.com/login/callback?code=...</code> is receiving an <strong>authorization code</strong> that will be exchanged for:
                <br/>‚Ä¢ <strong>ID Token</strong> (proves authentication - who you are)
                <br/>‚Ä¢ <strong>Access Token</strong> (grants authorization - what you can access)
                <br/>‚Ä¢ <strong>Refresh Token</strong> (gets new tokens when they expire)
            </p>
        </div>

        <h2 style="color: #16a085; border-left: 5px solid #16a085; padding-left: 15px; margin-top: 60px;">ÔøΩ OAuth 2.0 Grant Types Explained</h2>

        <table class="protocol-table">
            <thead>
                <tr>
                    <th>Grant Type</th>
                    <th>Use Case</th>
                    <th>Flow</th>
                    <th>Security</th>
                </tr>
            </thead>
            <tbody>
                <tr style="background: #e8f5e9;">
                    <td><strong>Authorization Code Grant</strong><br/><span class="badge badge-oidc">USED IN FLOW 2</span></td>
                    <td>
                        ‚Ä¢ Web applications with backend<br/>
                        ‚Ä¢ Mobile apps (with PKCE)<br/>
                        ‚Ä¢ Most secure OAuth flow<br/>
                        ‚Ä¢ OIDC authentication
                    </td>
                    <td>
                        1. User redirected to auth server<br/>
                        2. User logs in & consents<br/>
                        3. Auth server returns <strong>code</strong><br/>
                        4. Backend exchanges code for tokens<br/>
                        5. Tokens never exposed to browser
                    </td>
                    <td>
                        ‚úÖ Most secure<br/>
                        ‚úÖ PKCE protection<br/>
                        ‚úÖ Client authentication<br/>
                        ‚úÖ Token in backend only
                    </td>
                </tr>
                <tr>
                    <td><strong>Implicit Grant</strong><br/><span class="badge" style="background: #e74c3c; color: white;">DEPRECATED</span></td>
                    <td>
                        ‚Ä¢ Legacy SPAs (single-page apps)<br/>
                        ‚Ä¢ No backend server<br/>
                        ‚ùå No longer recommended
                    </td>
                    <td>
                        1. User redirected to auth server<br/>
                        2. Tokens returned directly in URL<br/>
                        3. No code exchange step<br/>
                        4. Tokens exposed in browser
                    </td>
                    <td>
                        ‚ùå Less secure<br/>
                        ‚ùå Token in URL fragment<br/>
                        ‚ùå No refresh tokens<br/>
                        Use Auth Code + PKCE instead
                    </td>
                </tr>
                <tr>
                    <td><strong>Client Credentials Grant</strong></td>
                    <td>
                        ‚Ä¢ Machine-to-machine (M2M)<br/>
                        ‚Ä¢ Backend services<br/>
                        ‚Ä¢ No user interaction<br/>
                        ‚Ä¢ API integrations
                    </td>
                    <td>
                        1. Client sends credentials to auth server<br/>
                        2. Auth server validates client<br/>
                        3. Access token returned<br/>
                        4. No user authentication
                    </td>
                    <td>
                        ‚úÖ Simple for M2M<br/>
                        ‚úÖ No user context<br/>
                        ‚ö†Ô∏è Client must be confidential<br/>
                        ‚ö†Ô∏è Store credentials securely
                    </td>
                </tr>
                <tr>
                    <td><strong>Resource Owner Password Credentials</strong><br/><span class="badge" style="background: #f39c12; color: white;">NOT RECOMMENDED</span></td>
                    <td>
                        ‚Ä¢ Legacy apps<br/>
                        ‚Ä¢ Highly trusted first-party apps<br/>
                        ‚ö†Ô∏è Avoid if possible
                    </td>
                    <td>
                        1. User provides username/password to client<br/>
                        2. Client sends credentials to auth server<br/>
                        3. Access token returned<br/>
                        4. No redirect flow
                    </td>
                    <td>
                        ‚ùå Credentials shared with client<br/>
                        ‚ùå No MFA support<br/>
                        ‚ùå Client sees password<br/>
                        Use Auth Code instead
                    </td>
                </tr>
                <tr>
                    <td><strong>Refresh Token Grant</strong></td>
                    <td>
                        ‚Ä¢ Get new access tokens<br/>
                        ‚Ä¢ Without re-authentication<br/>
                        ‚Ä¢ Used with other grants
                    </td>
                    <td>
                        1. Client has refresh token<br/>
                        2. Access token expires<br/>
                        3. Client sends refresh token<br/>
                        4. New access token returned
                    </td>
                    <td>
                        ‚úÖ Long-lived sessions<br/>
                        ‚úÖ No password re-entry<br/>
                        ‚ö†Ô∏è Refresh tokens must be secured<br/>
                        ‚úÖ Can be revoked
                    </td>
                </tr>
            </tbody>
        </table>

        <div style="background: #fff3cd; border-left: 4px solid #f39c12; padding: 20px; margin: 30px 0; border-radius: 4px;">
            <h3 style="color: #e67e22; margin-top: 0;">üí° Why Authorization Code Grant is the Best Choice</h3>
            <p><strong>Used in Flow 2 (xmy.com callback):</strong></p>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li><strong>Two-step process:</strong> Authorization code ‚Üí Token exchange (code never used directly)</li>
                <li><strong>PKCE enhancement:</strong> Prevents authorization code interception attacks</li>
                <li><strong>Tokens stay server-side:</strong> Access token never exposed to browser/frontend</li>
                <li><strong>Client authentication:</strong> Backend proves its identity when exchanging code</li>
                <li><strong>Refresh tokens:</strong> Long-lived sessions without re-login</li>
                <li><strong>Works everywhere:</strong> Web apps, mobile apps (with PKCE), native apps</li>
            </ul>
            <p style="margin-top: 15px; background: white; padding: 15px; border-radius: 4px;"><strong>Parameter Flow:</strong></p>
            <ol style="margin-left: 20px; background: white; padding: 15px; border-radius: 4px;">
                <li><strong>Step 3 - Authorization Request:</strong>
                    <br/><code>GET /authorize?response_type=code&scope=openid profile email&state=...&code_challenge=...</code>
                    <br/>üîπ <code>response_type=code</code> indicates Authorization Code Grant
                    <br/>üîπ <code>scope=openid</code> enables OIDC authentication
                </li>
                <li style="margin-top: 10px;"><strong>Step 7 - Callback (URL in browser):</strong>
                    <br/><code>https://xmy.com/login/callback?code=66H8OA25Z9...&state=xN4u...</code>
                    <br/>üîπ Authorization code is short-lived and single-use
                </li>
                <li style="margin-top: 10px;"><strong>Step 8 - Token Exchange (backend POST):</strong>
                    <br/><code>POST /token</code> with body:
                    <br/><code>grant_type=authorization_code&code=66H8OA25Z9...&code_verifier=...</code>
                    <br/>üîπ <code>grant_type=authorization_code</code> explicitly specified
                    <br/>üîπ Backend-to-backend secure exchange for tokens
                </li>
            </ol>
        </div>


        <h2 style="color: #e67e22; border-left: 5px solid #e67e22; padding-left: 15px; margin-top: 60px;">Flow 4: OAuth Client Credentials Grant (Machine-to-Machine)</h2>
        <div style="background: #fff5e6; border-left: 4px solid #e67e22; padding: 15px; margin: 20px; border-radius: 4px;">
            <strong>Grant Type:</strong> OAuth 2.0 Client Credentials Grant<br/>
            <strong>Flow Type:</strong> Machine-to-Machine Authentication (No User Context)<br/>
            <strong>Protocol:</strong> OAuth 2.0 (Service-to-Service)<br/>
            <strong>Source:</strong> web-int.webex.com-login.har (Production Backend Services)<br/>
            <strong>Endpoint:</strong> https://idbrokerbts.webex.com/idb/oauth2/v1/access_token<br/>
            <strong>Pattern:</strong> Backend services authenticate with client_id + client_secret<br/>
            <strong>Token Lifetime:</strong> 1 hour (no refresh token - stateless)
        </div>
        
        <div class="diagram-container">
            <div class="mermaid">
sequenceDiagram
    autonumber
    participant ServiceA as ‚öôÔ∏è Backend Service A<br/>(API Client)
    participant TokenEndpoint as üîë OAuth Token Endpoint<br/>(IDbroker)
    participant ServiceB as üõ°Ô∏è Protected Service B<br/>(API Resource Server)
    
    rect rgb(255, 245, 235)
    Note over ServiceA,ServiceB: üü† OAuth 2.0 Client Credentials Grant (M2M)
    Note over ServiceA,ServiceB: No user context - Service-to-Service authentication
    end
    
    ServiceA->>ServiceA: Need to call Service B API
    
    ServiceA->>TokenEndpoint: POST /idb/oauth2/v1/access_token<br/>Content-Type: application/x-www-form-urlencoded<br/><br/>grant_type=client_credentials<br/>client_id=Ce721947...<br/>client_secret=5xK9...secret...<br/>scope=webexsquare:admin webexsquare:get_conversation Identity:SCIM<br/>self_contained_token=true
    
    rect rgb(255, 245, 235)
    Note over TokenEndpoint: ‚úÖ OAuth CLIENT CREDENTIALS<br/>‚úÖ Validate client_id + client_secret<br/>‚úÖ Check service permissions<br/>‚úÖ Verify requested scopes<br/>‚úÖ Generate JWT access token<br/>‚ùå No refresh token (stateless)
    end
    
    TokenEndpoint->>ServiceA: HTTP 200 OK<br/>{<br/>  "access_token": "eyJhbGciOiJSUzI1NiJ9...",<br/>  "token_type": "Bearer",<br/>  "expires_in": 3600<br/>}
    
    Note over ServiceA: ‚úÖ Store token in memory<br/>Token contains service-level scopes<br/>Valid for 1 hour
    
    ServiceA->>ServiceB: GET /api/conversations<br/>Authorization: Bearer eyJhbGciOiJSUzI1NiJ9...<br/>Content-Type: application/json
    
    Note over ServiceB: ‚úÖ Validate JWT signature (RS256)<br/>‚úÖ Check token expiration<br/>‚úÖ Verify scopes (webexsquare:get_conversation)<br/>‚úÖ Check service permissions<br/>‚ùå No user context in token
    
    ServiceB->>ServiceA: HTTP 200 OK<br/>{"conversations": [...]}
    
    Note over ServiceA,ServiceB: Token expires after 1 hour
    
    alt Token Expired
        ServiceA->>TokenEndpoint: Request new token<br/>grant_type=client_credentials
        TokenEndpoint->>ServiceA: New access_token
    end
    
    Note over ServiceA,ServiceB: No refresh token - must re-authenticate<br/>Stateless pattern for microservices
            </div>
        </div>

        <div class="info-grid">
            <div class="info-card" style="background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);">
                <h3>üéØ Client Credentials Request</h3>
                <pre style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 0.85em;">POST /idb/oauth2/v1/access_token
Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials
&client_id=Ce721947...
&client_secret=5xK9...secret...
&scope=webexsquare%3Aadmin%20webexsquare%3Aget_conversation%20Identity%3ASCIM
&self_contained_token=true</pre>
                <p style="margin-top: 10px; font-size: 0.9em;">‚úÖ Machine-to-machine authentication<br/>‚úÖ No user context or refresh token<br/>‚úÖ Service-to-service API calls</p>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #d35400 0%, #a04000 100%);">
                <h3>üìã Token Response</h3>
                <pre style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 0.85em;">{
  "access_token": "eyJhbGciOiJSUzI1NiJ9...",
  "token_type": "Bearer",
  "expires_in": 3600
}</pre>
                <p style="margin-top: 10px; font-size: 0.9em;">üî∏ JWT self-contained token<br/>üî∏ 1 hour expiration<br/>üî∏ No refresh_token (stateless)</p>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #c0392b 0%, #8b0000 100%);">
                <h3>üîê OAuth Scopes</h3>
                <ul style="font-size: 0.9em;">
                    <li><code>webexsquare:admin</code> - Admin API access</li>
                    <li><code>webexsquare:get_conversation</code> - Read conversations</li>
                    <li><code>Identity:SCIM</code> - User provisioning (SCIM protocol)</li>
                </ul>
                <p style="margin-top: 10px; font-size: 0.9em;">‚öôÔ∏è Backend service permissions<br/>‚öôÔ∏è No user-level scopes needed</p>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                <h3>üèóÔ∏è Architecture Pattern</h3>
                <p style="font-size: 0.9em;"><strong>Service Flow:</strong> OAuth 2.0 Client Credentials (Pure M2M)</p>
                <p style="margin-top: 15px; font-size: 0.9em; line-height: 1.6;">
                    üîπ Backend service authenticates with client credentials<br/>
                    üîπ Receives JWT access token valid for 1 hour<br/>
                    üîπ Uses Bearer token for API calls<br/>
                    üîπ No user context in token (service identity only)<br/>
                    üîπ Stateless - request new token when expired<br/>
                    üîπ Ideal for: Microservices, scheduled jobs, IoT devices
                </p>
            </div>
        </div>

        <div style="background: #fff5e6; border: 2px solid #e67e22; padding: 20px; margin-top: 30px; border-radius: 8px;">
            <h3 style="color: #e67e22; margin-top: 0;">üîç When to Use Client Credentials Grant</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                <div>
                    <h4 style="color: #27ae60;">‚úÖ Good Use Cases:</h4>
                    <ul style="margin-left: 20px;">
                        <li><strong>Microservices:</strong> Service A calling Service B APIs</li>
                        <li><strong>Scheduled Jobs:</strong> Cron jobs that need API access</li>
                        <li><strong>Backend Workers:</strong> Processing queues, batch operations</li>
                        <li><strong>IoT Devices:</strong> Headless devices authenticating</li>
                        <li><strong>CI/CD Pipelines:</strong> Automated deployments</li>
                    </ul>
                </div>
                <div>
                    <h4 style="color: #e74c3c;">‚ùå Wrong Use Cases:</h4>
                    <ul style="margin-left: 20px;">
                        <li><strong>User Actions:</strong> Use Authorization Code instead</li>
                        <li><strong>SPAs/Frontend:</strong> Client secret can't be hidden</li>
                        <li><strong>Mobile Apps:</strong> Credentials can be extracted</li>
                        <li><strong>User Context Needed:</strong> No user identity in token</li>
                        <li><strong>Long Sessions:</strong> No refresh token available</li>
                    </ul>
                </div>
            </div>
            <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 4px;">
                <p><strong>Key Difference:</strong></p>
                <p style="margin-top: 10px;">üî∏ <strong>Authorization Code:</strong> "I'm acting on behalf of User X who gave me permission" ‚Üí Has user context, refresh tokens</p>
                <p style="margin-top: 5px;">üî∏ <strong>Client Credentials:</strong> "I'm Service Y with my own credentials" ‚Üí No user context, service-level permissions only</p>
            </div>
        </div>


        <h2 style="color: #16a085; border-left: 5px solid #16a085; padding-left: 15px; margin-top: 60px;">ÔøΩüì¶ Real-World Examples</h2>

        <table class="protocol-table">
            <thead>
                <tr>
                    <th>Service</th>
                    <th>Protocol Used</th>
                    <th>Reason</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Identity Broker</strong></td>
                    <td><span class="badge badge-saml">SAML 2.0</span> + <span class="badge badge-oauth">OAuth 2.0</span></td>
                    <td>SAML authentication ‚Üí OAuth token issuance for APIs</td>
                </tr>
                <tr>
                    <td><strong>Atlassian Confluence</strong></td>
                    <td><span class="badge badge-saml">SAML 2.0</span> + <span class="badge badge-oauth">OAuth 2.0</span></td>
                    <td>Enterprise SSO + API access</td>
                </tr>
                <tr>
                    <td><strong>GitHub</strong></td>
                    <td><span class="badge badge-oidc">OIDC</span> <span class="badge badge-oauth">OAuth 2.0</span></td>
                    <td>Social login + API access (not plain OAuth)</td>
                </tr>
                <tr>
                    <td><strong>Google Workspace</strong></td>
                    <td><span class="badge badge-saml">SAML 2.0</span></td>
                    <td>Enterprise SSO for organizations</td>
                </tr>
                <tr>
                    <td><strong>Okta</strong></td>
                    <td><span class="badge badge-saml">SAML 2.0</span> + <span class="badge badge-oauth">OAuth 2.0</span> + <span class="badge badge-oidc">OIDC</span></td>
                    <td>Universal identity platform</td>
                </tr>
                <tr>
                    <td><strong>Salesforce</strong></td>
                    <td><span class="badge badge-saml">SAML 2.0</span> + <span class="badge badge-oauth">OAuth 2.0</span></td>
                    <td>SSO + REST API authorization</td>
                </tr>
                <tr>
                    <td><strong>Slack</strong></td>
                    <td><span class="badge badge-oidc">OIDC</span> <span class="badge badge-oauth">OAuth 2.0</span></td>
                    <td>Sign in with Slack + app integrations</td>
                </tr>
                <tr>
                    <td><strong>AWS IAM</strong></td>
                    <td><span class="badge badge-saml">SAML 2.0</span></td>
                    <td>Enterprise federation (AWS SSO)</td>
                </tr>
                <tr>
                    <td><strong>Azure AD</strong></td>
                    <td><span class="badge badge-saml">SAML 2.0</span> + <span class="badge badge-oauth">OAuth 2.0</span> + <span class="badge badge-oidc">OIDC</span></td>
                    <td>Enterprise IdP supporting all protocols</td>
                </tr>
            </tbody>
        </table>

        <table class="protocol-table">

        <div class="info-grid" style="margin-top: 40px;">
            <div class="info-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                <h3>üìã SAML Assertion Contains</h3>
                <ul>
                    <li>User ID (employee ID)</li>
                    <li>Email address</li>
                    <li>Display name</li>
                    <li>Groups/departments</li>
                    <li>Session validity period</li>
                    <li>Digital signature</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
                <h3>üéØ OAuth Token Contains</h3>
                <ul>
                    <li>User identifier (sub claim)</li>
                    <li>Issued at / Expiration time</li>
                    <li>Audience (Confluence)</li>
                    <li>Scopes (read:confluence, write:confluence)</li>
                    <li>Resource ARIs</li>
                    <li>JWT signature</li>
                </ul>
            </div>

            <div class="info-card" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">
                <h3>üîç URL Components</h3>
                <ul>
                    <li><strong>orgId:</strong> Organization ID</li>
                    <li><strong>resource:</strong> ari:cloud:confluence::site/...</li>
                    <li><strong>application:</strong> confluence</li>
                    <li><strong>continue:</strong> Post-auth redirect URL</li>
                    <li><strong>Site ID:</strong> cc5672c2-37d3-438b-9543-58ff06df6f4c</li>
                </ul>
            </div>
        </div>

        <h2 style="color: #c0392b; border-left: 5px solid #c0392b; padding-left: 15px; margin-top: 60px;">üõ°Ô∏è OWASP Top 10 Security Controls in These Flows</h2>
        
        <div style="background: #fff0f0; border: 3px solid #c0392b; padding: 25px; margin: 20px 0; border-radius: 8px;">
            <h3 style="color: #c0392b; margin-top: 0;">üîí Security Headers (From HAR Analysis - Flow 4)</h3>
            <div style="background: white; padding: 20px; border-radius: 6px; margin-top: 15px;">
                <table class="protocol-table">
                    <thead>
                        <tr>
                            <th>Security Header</th>
                            <th>Value / Purpose</th>
                            <th>OWASP Protection</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>Strict-Transport-Security</code></td>
                            <td>max-age=31536000; includeSubDomains<br/>üîπ Forces HTTPS for 1 year</td>
                            <td>üõ°Ô∏è <strong>A02:2021 Cryptographic Failures</strong><br/>Prevents SSL stripping attacks</td>
                        </tr>
                        <tr>
                            <td><code>Content-Security-Policy</code></td>
                            <td>default-src 'self'; script-src 'self' 'unsafe-inline'<br/>üîπ Controls resource loading</td>
                            <td>üõ°Ô∏è <strong>A03:2021 Injection</strong><br/>Mitigates XSS attacks by blocking untrusted scripts</td>
                        </tr>
                        <tr>
                            <td><code>X-Frame-Options</code></td>
                            <td>SAMEORIGIN<br/>üîπ Prevents iframe embedding</td>
                            <td>üõ°Ô∏è <strong>A01:2021 Broken Access Control</strong><br/>Blocks clickjacking attacks</td>
                        </tr>
                        <tr>
                            <td><code>X-Content-Type-Options</code></td>
                            <td>nosniff<br/>üîπ Prevents MIME sniffing</td>
                            <td>üõ°Ô∏è <strong>A03:2021 Injection</strong><br/>Stops browser from executing incorrect content types</td>
                        </tr>
                        <tr>
                            <td><code>X-XSS-Protection</code></td>
                            <td>1; mode=block<br/>üîπ Browser XSS filter</td>
                            <td>üõ°Ô∏è <strong>A03:2021 Injection</strong><br/>Legacy XSS protection (now superseded by CSP)</td>
                        </tr>
                        <tr>
                            <td><code>Referrer-Policy</code></td>
                            <td>strict-origin-when-cross-origin<br/>üîπ Controls referrer information</td>
                            <td>üõ°Ô∏è <strong>A05:2021 Security Misconfiguration</strong><br/>Prevents sensitive URL leakage</td>
                        </tr>
                        <tr>
                            <td><code>Permissions-Policy</code></td>
                            <td>geolocation=(), microphone=(), camera=()<br/>üîπ Disables browser features</td>
                            <td>üõ°Ô∏è <strong>A01:2021 Broken Access Control</strong><br/>Restricts API access to sensitive features</td>
                        </tr>
                        <tr>
                            <td><code>Cache-Control</code></td>
                            <td>no-store, no-cache, must-revalidate<br/>üîπ Prevents token caching</td>
                            <td>üõ°Ô∏è <strong>A07:2021 Auth Failures</strong><br/>Ensures tokens aren't stored in browser cache</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div style="background: #f0f8ff; border: 2px solid #3498db; padding: 25px; margin: 20px 0; border-radius: 8px;">
            <h3 style="color: #2c3e50; margin-top: 0;">üéØ OWASP Top 10 2021 - Mitigations Implemented</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <div style="background: white; padding: 20px; border-radius: 6px; border-left: 4px solid #e74c3c;">
                    <h4 style="color: #e74c3c; margin-top: 0;">A01:2021 ‚Äì Broken Access Control</h4>
                    <p style="font-size: 0.9em; line-height: 1.6;">
                        ‚úÖ <strong>JWT with scopes:</strong> Fine-grained permissions (spark:calls_write, telephony_config_write)<br/>
                        ‚úÖ <strong>State parameter:</strong> CSRF protection in OAuth flow<br/>
                        ‚úÖ <strong>Short-lived codes:</strong> Authorization codes single-use & expire in 60s<br/>
                        ‚úÖ <strong>Audience validation:</strong> JWT 'aud' claim validates intended recipient<br/>
                        ‚úÖ <strong>Origin validation:</strong> CORS headers restrict API access
                    </p>
                </div>

                <div style="background: white; padding: 20px; border-radius: 6px; border-left: 4px solid #3498db;">
                    <h4 style="color: #3498db; margin-top: 0;">A02:2021 ‚Äì Cryptographic Failures</h4>
                    <p style="font-size: 0.9em; line-height: 1.6;">
                        ‚úÖ <strong>TLS 1.2+:</strong> All traffic encrypted (HTTPS only)<br/>
                        ‚úÖ <strong>HSTS:</strong> Forces HTTPS for 1 year (max-age=31536000)<br/>
                        ‚úÖ <strong>RS256 JWT signing:</strong> Tokens cryptographically signed with RSA<br/>
                        ‚úÖ <strong>Secure cookies:</strong> HttpOnly, Secure, SameSite attributes<br/>
                        ‚úÖ <strong>No plaintext secrets:</strong> Client credentials never in frontend
                    </p>
                </div>

                <div style="background: white; padding: 20px; border-radius: 6px; border-left: 4px solid #2ecc71;">
                    <h4 style="color: #2ecc71; margin-top: 0;">A03:2021 ‚Äì Injection</h4>
                    <p style="font-size: 0.9em; line-height: 1.6;">
                        ‚úÖ <strong>CSP:</strong> Blocks inline scripts & eval()<br/>
                        ‚úÖ <strong>JWT claims:</strong> Structured data prevents SQL/command injection<br/>
                        ‚úÖ <strong>URL encoding:</strong> Parameters properly encoded (client_id, redirect_uri)<br/>
                        ‚úÖ <strong>SAML signing:</strong> XML signatures prevent assertion tampering<br/>
                        ‚úÖ <strong>Input validation:</strong> Authorization codes validated against expected format
                    </p>
                </div>

                <div style="background: white; padding: 20px; border-radius: 6px; border-left: 4px solid #f39c12;">
                    <h4 style="color: #f39c12; margin-top: 0;">A04:2021 ‚Äì Insecure Design</h4>
                    <p style="font-size: 0.9em; line-height: 1.6;">
                        ‚úÖ <strong>PKCE (RFC 7636):</strong> Authorization code interception prevention<br/>
                        ‚úÖ <strong>Token rotation:</strong> New refresh token issued on each use<br/>
                        ‚úÖ <strong>Nonce:</strong> Replay attack prevention in OIDC<br/>
                        ‚úÖ <strong>Rate limiting:</strong> Token endpoint throttling (evident from 429 responses)<br/>
                        ‚úÖ <strong>Separate contexts:</strong> User tokens vs service tokens (Flow 5)
                    </p>
                </div>

                <div style="background: white; padding: 20px; border-radius: 6px; border-left: 4px solid #9b59b6;">
                    <h4 style="color: #9b59b6; margin-top: 0;">A05:2021 ‚Äì Security Misconfiguration</h4>
                    <p style="font-size: 0.9em; line-height: 1.6;">
                        ‚úÖ <strong>Hardened headers:</strong> 8+ security headers configured<br/>
                        ‚úÖ <strong>No directory listing:</strong> Error pages don't expose structure<br/>
                        ‚úÖ <strong>Minimal server info:</strong> Server: istio-envoy (no version)<br/>
                        ‚úÖ <strong>CORS restrictions:</strong> Access-Control-Allow-Origin properly configured<br/>
                        ‚úÖ <strong>No default credentials:</strong> OAuth client secrets rotated regularly
                    </p>
                </div>

                <div style="background: white; padding: 20px; border-radius: 6px; border-left: 4px solid #1abc9c;">
                    <h4 style="color: #1abc9c; margin-top: 0;">A07:2021 ‚Äì Identification & Authentication Failures</h4>
                    <p style="font-size: 0.9em; line-height: 1.6;">
                        ‚úÖ <strong>MFA support:</strong> SAML supports multi-factor authentication<br/>
                        ‚úÖ <strong>Token expiration:</strong> Access tokens expire in 1-18 hours<br/>
                        ‚úÖ <strong>Refresh token rotation:</strong> One-time use refresh tokens<br/>
                        ‚úÖ <strong>Session management:</strong> Proper logout invalidates tokens<br/>
                        ‚úÖ <strong>emailHash validation:</strong> Email verified before SSO redirect
                    </p>
                </div>

                <div style="background: white; padding: 20px; border-radius: 6px; border-left: 4px solid #e67e22;">
                    <h4 style="color: #e67e22; margin-top: 0;">A08:2021 ‚Äì Software & Data Integrity Failures</h4>
                    <p style="font-size: 0.9em; line-height: 1.6;">
                        ‚úÖ <strong>JWT signature verification:</strong> RS256 prevents token tampering<br/>
                        ‚úÖ <strong>SAML assertions signed:</strong> XMLDSig prevents XML tampering<br/>
                        ‚úÖ <strong>Subresource Integrity:</strong> CSP with hashes for static assets<br/>
                        ‚úÖ <strong>Token binding:</strong> JWT 'jti' (JWT ID) prevents token substitution<br/>
                        ‚úÖ <strong>Istio service mesh:</strong> mTLS between microservices
                    </p>
                </div>

                <div style="background: white; padding: 20px; border-radius: 6px; border-left: 4px solid #e74c3c;">
                    <h4 style="color: #e74c3c; margin-top: 0;">A09:2021 ‚Äì Security Logging & Monitoring</h4>
                    <p style="font-size: 0.9em; line-height: 1.6;">
                        ‚úÖ <strong>TrackingID:</strong> Every request has unique ID for audit trail<br/>
                        ‚úÖ <strong>Request timing:</strong> Performance metrics logged (730ms total)<br/>
                        ‚úÖ <strong>Failed auth logging:</strong> 401/403 responses tracked<br/>
                        ‚úÖ <strong>Token issuance logs:</strong> OAuth grants logged with timestamp<br/>
                        ‚úÖ <strong>Cluster tracking:</strong> PS65 cluster ID in JWT for routing
                    </p>
                </div>
            </div>
        </div>

        <div style="background: #fff9e6; border: 2px solid #f39c12; padding: 25px; margin: 20px 0; border-radius: 8px;">
            <h3 style="color: #2c3e50; margin-top: 0;">üîê OWASP API Security Top 10 - Mitigations</h3>
            
            <table class="protocol-table" style="margin-top: 20px;">
                <thead>
                    <tr>
                        <th style="width: 30%;">API Security Risk</th>
                        <th>Mitigation in Flows</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>API1:2023 Broken Object Level Authorization</strong></td>
                        <td>
                            <strong>üéØ Flow 1 (SAML - Atlassian):</strong><br/>
                            ‚úÖ Session-based authorization with Atlassian-token (BOZI-RZAB-0Q2B-FFXS...)<br/>
                            ‚úÖ SAML assertion includes user identity and group memberships<br/>
                            ‚úÖ Space-level and project-level access control (IPCBU wiki, CALL-190355 issue)<br/>
                            ‚úÖ JSESSIONID cookie tracks authenticated session<br/>
                            <br/>
                            <strong>üéØ Flow 3 (Hybrid SAML+OAuth - Webex):</strong><br/>
                            ‚úÖ JWT contains user/org context (org_id: b'1eb65fdf-9643-417f-9974-ad72cae0e10f', cis_uuid: sekondav)<br/>
                            ‚úÖ Scopes limit data access (spark:calls_write NOT spark:calls_read_all)<br/>
                            ‚úÖ Resource owner validation in every API call via Bearer token<br/>
                            ‚úÖ Private claim in JWT (encrypted JWE) ensures context isolation<br/>
                            <br/>
                            <strong>üéØ Flow 4 (Client Credentials - M2M):</strong><br/>
                            ‚úÖ Service account with limited scopes (webexsquare:admin, Identity:SCIM)<br/>
                            ‚úÖ No user context - prevents horizontal privilege escalation<br/>
                            ‚úÖ Organization-level isolation enforced by backend
                        </td>
                    </tr>
                    <tr>
                        <td><strong>API2:2023 Broken Authentication</strong></td>
                        <td>
                            <strong>üéØ Flow 1 (SAML - Atlassian):</strong><br/>
                            ‚úÖ SAML 2.0 authentication via Corporate Identity (via Okta)<br/>
                            ‚úÖ MFA enforced (Duo/Microsoft Authenticator) before SAML assertion issuance<br/>
                            ‚úÖ Digital signature validation on SAML Response (9419 bytes)<br/>
                            ‚úÖ X-Seraph-LoginReason: OK header confirms successful authentication<br/>
                            ‚úÖ Origin header validation (https://identity.company.com)<br/>
                            <br/>
                            <strong>üéØ Flow 3 (Hybrid SAML+OAuth - Webex):</strong><br/>
                            ‚úÖ Bearer token authentication (Authorization: Bearer eyJhbGciOiJSUzI1NiI...)<br/>
                            ‚úÖ Token signature verification (RS256, 2048-bit RSA asymmetric encryption)<br/>
                            ‚úÖ Token expiration enforced (exp: 1736513697, 18 hours lifetime)<br/>
                            ‚úÖ Refresh token rotation (59 days validity, prevents token theft reuse)<br/>
                            ‚úÖ PKCE (Proof Key for Code Exchange) prevents authorization code interception<br/>
                            <br/>
                            <strong>üéØ Flow 4 (Client Credentials - M2M):</strong><br/>
                            ‚úÖ Client credentials grant (client_secret authentication)<br/>
                            ‚úÖ No user passwords in APIs - service account only<br/>
                            ‚úÖ Short-lived tokens (3600s = 1 hour) minimize exposure window<br/>
                            ‚úÖ Stateless JWT eliminates server-side session vulnerabilities
                        </td>
                    </tr>
                    <tr>
                        <td><strong>API3:2023 Broken Object Property Level Authorization</strong></td>
                        <td>
                            <strong>üéØ Flow 1 (SAML - Atlassian):</strong><br/>
                            ‚úÖ Atlassian Resource Identifier (ARI) scopes field-level access<br/>
                            ‚úÖ Space permissions control visible properties (read-only vs edit)<br/>
                            ‚úÖ Issue field permissions (view all fields vs restricted fields)<br/>
                            <br/>
                            <strong>üéØ Flow 3 (Hybrid SAML+OAuth - Webex):</strong><br/>
                            ‚úÖ Scopes control field access (Identity:SCIM for user provisioning - firstName, lastName, email)<br/>
                            ‚úÖ Fine-grained permissions per resource type (spark:calls_read vs spark:calls_write)<br/>
                            ‚úÖ Read/write scopes separated (webexsquare:get_conversation vs webexsquare:admin)<br/>
                            ‚úÖ 16+ distinct scopes limit property exposure (spark:kms, telephony_config_write, contact-center-digital)<br/>
                            <br/>
                            <strong>üéØ Flow 4 (Client Credentials - M2M):</strong><br/>
                            ‚úÖ Service scopes exclude user properties (no profile, email scopes)<br/>
                            ‚úÖ Admin-level scopes limit bulk operations (webexsquare:admin for internal services only)
                        </td>
                    </tr>
                    <tr>
                        <td><strong>API4:2023 Unrestricted Resource Consumption</strong></td>
                        <td>
                            <strong>üéØ Flow 1 (SAML - Atlassian):</strong><br/>
                            ‚úÖ Session timeout (jira.session.expiry.in.mins: 299 minutes = ~5 hours)<br/>
                            ‚úÖ Concurrent request limit (jira.request.concurrent.requests: 6)<br/>
                            ‚úÖ SAML assertion replay prevention (timestamp + ID uniqueness)<br/>
                            <br/>
                            <strong>üéØ Flow 3 (Hybrid SAML+OAuth - Webex):</strong><br/>
                            ‚úÖ Token expiration limits session duration (3600s = 1 hour for M2M, 18 hours for user tokens)<br/>
                            ‚úÖ Rate limiting on token endpoint (429 Too Many Requests with Retry-After header)<br/>
                            ‚úÖ Scope-based quotas (different API call limits per scope)<br/>
                            ‚úÖ Request throttling via TrackingID (1kbvuu6cj6kxq for distributed tracing)<br/>
                            ‚úÖ Performance metrics tracked (227ms server wait, 730ms total latency)<br/>
                            <br/>
                            <strong>üéØ Flow 4 (Client Credentials - M2M):</strong><br/>
                            ‚úÖ Short token lifetime (1 hour) prevents long-term abuse<br/>
                            ‚úÖ No refresh token - must re-authenticate after expiration<br/>
                            ‚úÖ Client-level rate limiting enforced
                        </td>
                    </tr>
                    <tr>
                        <td><strong>API5:2023 Broken Function Level Authorization</strong></td>
                        <td>
                            <strong>üéØ Flow 1 (SAML - Atlassian):</strong><br/>
                            ‚úÖ Administrative functions require elevated SAML attributes<br/>
                            ‚úÖ Space admin vs member permissions enforced<br/>
                            ‚úÖ Project admin required for issue deletion/bulk operations<br/>
                            <br/>
                            <strong>üéØ Flow 3 (Hybrid SAML+OAuth - Webex):</strong><br/>
                            ‚úÖ Administrative scopes required (webexsquare:admin for management operations)<br/>
                            ‚úÖ Function-level scopes (telephony_config_write, contact-center-digital, calling-subscriber-device)<br/>
                            ‚úÖ Backend validates scope before executing privileged operations (config changes, user provisioning)<br/>
                            ‚úÖ Write operations require explicit write scopes (calls_write, machines_write)<br/>
                            <br/>
                            <strong>üéØ Flow 4 (Client Credentials - M2M):</strong><br/>
                            ‚úÖ Service accounts limited to specific functions (webexsquare:admin for internal only)<br/>
                            ‚úÖ No user impersonation capabilities
                        </td>
                    </tr>
                    <tr>
                        <td><strong>API6:2023 Unrestricted Access to Sensitive Business Flows</strong></td>
                        <td>
                            <strong>üéØ Flow 1 (SAML - Atlassian):</strong><br/>
                            ‚úÖ MFA required for sensitive Jira workflows (approval gates)<br/>
                            ‚úÖ Audit logs for administrative actions (user access changes)<br/>
                            ‚úÖ Session re-authentication for dangerous operations (bulk delete)<br/>
                            <br/>
                            <strong>üéØ Flow 3 (Hybrid SAML+OAuth - Webex):</strong><br/>
                            ‚úÖ OAuth consent screen for sensitive operations (first-time scope authorization)<br/>
                            ‚úÖ User must explicitly authorize scope access (spark:kms for encryption key access)<br/>
                            ‚úÖ Refresh tokens revocable via admin console (enterprise.webex.com/admin)<br/>
                            ‚úÖ Step-up authentication for high-value operations (account takeover prevention)<br/>
                            <br/>
                            <strong>üéØ Flow 4 (Client Credentials - M2M):</strong><br/>
                            ‚úÖ No direct user interaction - prevents social engineering<br/>
                            ‚úÖ Service account actions auditable with client_id tracking
                        </td>
                    </tr>
                    <tr>
                        <td><strong>API7:2023 Server Side Request Forgery</strong></td>
                        <td>
                            <strong>üéØ Flow 1 (SAML - Atlassian):</strong><br/>
                            ‚úÖ SAML ACS (Assertion Consumer Service) URL whitelist enforced (/plugins/servlet/samlconsumer)<br/>
                            ‚úÖ Destination attribute validation in SAML Response (must match SP endpoint)<br/>
                            ‚úÖ Origin header validation (must be https://identity.company.com)<br/>
                            ‚úÖ Sec-Fetch-Site: same-site prevents cross-site SSRF<br/>
                            <br/>
                            <strong>üéØ Flow 3 (Hybrid SAML+OAuth - Webex):</strong><br/>
                            ‚úÖ Redirect URI whitelist (registered with IdP: https://desktop.company.com/callback)<br/>
                            ‚úÖ URL validation before OAuth redirects (exact match, no wildcard)<br/>
                            ‚úÖ SAML ACS URL strictly validated (https://idbroker-sg.webex.com/idb/saml2/sso)<br/>
                            ‚úÖ State parameter prevents redirect manipulation (cryptographic random string)<br/>
                            <br/>
                            <strong>üéØ Flow 4 (Client Credentials - M2M):</strong><br/>
                            ‚úÖ No redirect URI (direct token endpoint access)<br/>
                            ‚úÖ Token endpoint URL pinned in client configuration
                        </td>
                    </tr>
                    <tr>
                        <td><strong>API8:2023 Security Misconfiguration</strong></td>
                        <td>
                            <strong>üéØ Flow 1 (SAML - Atlassian Jira):</strong><br/>
                            ‚úÖ <code>Strict-Transport-Security: max-age=31536000</code> (1 year HSTS, forces HTTPS)<br/>
                            ‚úÖ <code>X-Frame-Options: SAMEORIGIN</code> (clickjacking prevention, iframe restrictions)<br/>
                            ‚úÖ <code>Content-Security-Policy: frame-ancestors 'self'</code> (modern CSP, embedding control)<br/>
                            ‚úÖ <code>X-Content-Type-Options: nosniff</code> (MIME-sniffing prevention, content type enforcement)<br/>
                            ‚úÖ <code>X-XSS-Protection: enabled</code> (legacy XSS filter for older browsers)<br/>
                            ‚úÖ Error messages sanitized (no stack traces, no sensitive data exposure)<br/>
                            ‚úÖ TLS 1.2+ enforced (no SSLv3, TLS 1.0, or weak ciphers)<br/>
                            <br/>
                            <strong>üéØ Flow 3 (Hybrid SAML+OAuth - Webex):</strong><br/>
                            ‚úÖ <code>strict-transport-security: max-age=31536000</code> (HTTPS enforcement)<br/>
                            ‚úÖ <code>x-frame-options: DENY</code> (prevents all framing attacks)<br/>
                            ‚úÖ <code>x-content-type-options: nosniff</code> (MIME type protection)<br/>
                            ‚úÖ <code>x-xss-protection: 1; mode=block</code> (XSS filter active)<br/>
                            ‚úÖ <code>cache-control: no-cache, no-store</code> (prevents token caching)<br/>
                            ‚úÖ <code>referrer-policy: no-referrer-when-downgrade</code> (protects referrer leakage)<br/>
                            ‚úÖ CORS properly configured: <code>access-control-allow-origin: https://desktop.company.com</code> (not wildcard *)<br/>
                            ‚úÖ CORS credentials: <code>access-control-allow-credentials: true</code> (controlled credential sharing)<br/>
                            ‚úÖ CORS methods restricted: <code>access-control-allow-methods: POST, PUT, PATCH, HEAD, GET...</code> (no DELETE in public APIs)<br/>
                            ‚úÖ Security headers on all API responses (idbroker, webexapis, oauth endpoints)<br/>
                            <br/>
                            <strong>üéØ Flow 4 (Client Credentials - M2M):</strong><br/>
                            ‚úÖ Same security headers as Flow 3 (HSTS, X-Frame-Options, CSP)<br/>
                            ‚úÖ No CORS needed (server-to-server communication)<br/>
                            ‚úÖ TLS mutual authentication (mTLS) for service mesh (Istio)
                        </td>
                    </tr>
                    <tr>
                        <td><strong>API9:2023 Improper Inventory Management</strong></td>
                        <td>
                            <strong>üéØ Flow 1 (SAML - Atlassian):</strong><br/>
                            ‚úÖ Jira version tracked (v10.3.12 #10030012, build: f2378d8)<br/>
                            ‚úÖ SAML 2.0 specification compliance (endpoint documentation)<br/>
                            ‚úÖ API documentation for SAML endpoints (/sso/saml, /samlconsumer)<br/>
                            ‚úÖ Deprecated features logged (see footer: Report a problem)<br/>
                            <br/>
                            <strong>üéØ Flow 3 (Hybrid SAML+OAuth - Webex):</strong><br/>
                            ‚úÖ API versioning (v1 in /oauth2/v1/access_token, /authorization/v1/authorize)<br/>
                            ‚úÖ Deprecated endpoints return 410 Gone (old token endpoints sunset)<br/>
                            ‚úÖ API documentation with supported endpoints (developer.webex.com)<br/>
                            ‚úÖ Cluster version tracking (PS65 cluster ID in JWT for region-specific APIs)<br/>
                            ‚úÖ Scope inventory maintained (16+ documented scopes with descriptions)<br/>
                            <br/>
                            <strong>üéØ Flow 4 (Client Credentials - M2M):</strong><br/>
                            ‚úÖ Client ID registry (each service has unique client_id)<br/>
                            ‚úÖ Scope catalog for service accounts (admin, SCIM, get_conversation)<br/>
                            ‚úÖ API changelog for breaking changes
                        </td>
                    </tr>
                    <tr>
                        <td><strong>API10:2023 Unsafe Consumption of APIs</strong></td>
                        <td>
                            <strong>üéØ Flow 1 (SAML - Atlassian):</strong><br/>
                            ‚úÖ SAML assertion signature validation (XML digital signature verification)<br/>
                            ‚úÖ IdP certificate validation (Corporate Identity certificate trusted)<br/>
                            ‚úÖ RelayState integrity check (7424d1de-cbb2-4cc0-9cb9-2025eb983284 preserved)<br/>
                            ‚úÖ Input validation on SAML Response (9419 bytes, content-length verified)<br/>
                            ‚úÖ Origin validation (must be https://identity.company.com)<br/>
                            <br/>
                            <strong>üéØ Flow 3 (Hybrid SAML+OAuth - Webex):</strong><br/>
                            ‚úÖ JWT signature verification before trusting claims (RS256, public key from JWKS endpoint)<br/>
                            ‚úÖ SAML assertion signature validation (IdP certificate chain validation)<br/>
                            ‚úÖ TLS certificate pinning for backend services (Istio service mesh with mTLS)<br/>
                            ‚úÖ Input validation on all API responses (JSON schema validation)<br/>
                            ‚úÖ Token binding to prevent token theft (DPoP headers, future enhancement)<br/>
                            ‚úÖ Issuer validation (iss claim must match https://idbroker.webex.com/idb)<br/>
                            ‚úÖ Audience validation (aud claim must match client_id or resource server)<br/>
                            <br/>
                            <strong>üéØ Flow 4 (Client Credentials - M2M):</strong><br/>
                            ‚úÖ Client authentication via TLS (certificate-based for high-security services)<br/>
                            ‚úÖ Token introspection for untrusted tokens (verify with authorization server)<br/>
                            ‚úÖ Rate limiting on external API consumption (prevent DoS from upstream APIs)<br/>
                            ‚úÖ Circuit breaker pattern (fail fast if upstream OAuth server unavailable)
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div style="background: #e8f8f5; border: 2px solid #16a085; padding: 25px; margin: 20px 0; border-radius: 8px;">
            <h3 style="color: #2c3e50; margin-top: 0;">üõ†Ô∏è Additional Security Best Practices Observed</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 20px;">
                <div style="background: white; padding: 15px; border-radius: 6px;">
                    <h4 style="color: #16a085; margin-top: 0;">üîë Token Security</h4>
                    <ul style="font-size: 0.85em; line-height: 1.6; margin: 0; padding-left: 20px;">
                        <li>JWT with RS256 (asymmetric)</li>
                        <li>Token introspection endpoint</li>
                        <li>Token revocation support</li>
                        <li>Opaque refresh tokens</li>
                        <li>Token binding (DPoP future)</li>
                    </ul>
                </div>

                <div style="background: white; padding: 15px; border-radius: 6px;">
                    <h4 style="color: #3498db; margin-top: 0;">üåê Network Security</h4>
                    <ul style="font-size: 0.85em; line-height: 1.6; margin: 0; padding-left: 20px;">
                        <li>Istio service mesh (mTLS)</li>
                        <li>Load balancer health checks</li>
                        <li>Geographic routing (PS65 cluster)</li>
                        <li>DDoS protection (Cloudflare)</li>
                        <li>WAF rules (SQL injection, XSS)</li>
                    </ul>
                </div>

                <div style="background: white; padding: 15px; border-radius: 6px;">
                    <h4 style="color: #e67e22; margin-top: 0;">üìä Monitoring</h4>
                    <ul style="font-size: 0.85em; line-height: 1.6; margin: 0; padding-left: 20px;">
                        <li>Request tracing (TrackingID)</li>
                        <li>Timing metrics (227ms server wait)</li>
                        <li>Error rate monitoring</li>
                        <li>Token usage analytics</li>
                        <li>Anomaly detection</li>
                    </ul>
                </div>

                <div style="background: white; padding: 15px; border-radius: 6px;">
                    <h4 style="color: #9b59b6; margin-top: 0;">üîê CSRF Protection</h4>
                    <ul style="font-size: 0.85em; line-height: 1.6; margin: 0; padding-left: 20px;">
                        <li>State parameter (cryptographic random)</li>
                        <li>Nonce in OIDC</li>
                        <li>SameSite=Strict cookies</li>
                        <li>CORS preflight checks</li>
                        <li>Origin header validation</li>
                    </ul>
                </div>

                <div style="background: white; padding: 15px; border-radius: 6px;">
                    <h4 style="color: #e74c3c; margin-top: 0;">üõ°Ô∏è XSS Prevention</h4>
                    <ul style="font-size: 0.85em; line-height: 1.6; margin: 0; padding-left: 20px;">
                        <li>CSP with nonce</li>
                        <li>Output encoding</li>
                        <li>HttpOnly cookies</li>
                        <li>Sanitized error messages</li>
                        <li>No eval() or innerHTML</li>
                    </ul>
                </div>

                <div style="background: white; padding: 15px; border-radius: 6px;">
                    <h4 style="color: #c0392b; margin-top: 0;">‚è±Ô∏è Session Management</h4>
                    <ul style="font-size: 0.85em; line-height: 1.6; margin: 0; padding-left: 20px;">
                        <li>Absolute timeout (18 hours max)</li>
                        <li>Idle timeout (refresh token)</li>
                        <li>Concurrent session limits</li>
                        <li>Logout invalidates all tokens</li>
                        <li>Remember me = longer refresh token</li>
                    </ul>
                </div>
            </div>
        </div>

        <div style="background: #f9f3ff; border: 3px solid #8e44ad; padding: 25px; margin: 20px 0; border-radius: 8px;">
            <h3 style="color: #8e44ad; margin-top: 0;">üí° Security Recommendations for Implementation</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <div style="background: white; padding: 20px; border-radius: 6px; border-left: 4px solid #27ae60;">
                    <h4 style="color: #27ae60; margin-top: 0;">‚úÖ Must-Have Controls</h4>
                    <ol style="font-size: 0.9em; line-height: 1.8; margin: 0;">
                        <li><strong>Always use HTTPS</strong> - No exceptions, even in dev</li>
                        <li><strong>Implement PKCE</strong> - Required for SPAs and mobile apps</li>
                        <li><strong>Rotate secrets</strong> - Client secrets every 90 days</li>
                        <li><strong>Log everything</strong> - Authentication attempts, token issuance</li>
                        <li><strong>Validate redirect URIs</strong> - Exact match, no wildcards</li>
                        <li><strong>Use short-lived tokens</strong> - 15-60 minutes for access tokens</li>
                        <li><strong>Implement rate limiting</strong> - Token endpoint, API calls</li>
                        <li><strong>Enable MFA</strong> - For privileged operations</li>
                    </ol>
                </div>

                <div style="background: white; padding: 20px; border-radius: 6px; border-left: 4px solid #e67e22;">
                    <h4 style="color: #e67e22; margin-top: 0;">‚ö†Ô∏è Common Security Pitfalls to Avoid</h4>
                    <ol style="font-size: 0.9em; line-height: 1.8; margin: 0;">
                        <li><strong>‚ùå Never</strong> store tokens in localStorage (XSS vulnerable)</li>
                        <li><strong>‚ùå Never</strong> pass tokens in URL query parameters</li>
                        <li><strong>‚ùå Never</strong> use implicit grant (deprecated in OAuth 2.1)</li>
                        <li><strong>‚ùå Don't</strong> skip state parameter validation</li>
                        <li><strong>‚ùå Don't</strong> use wildcard CORS (*)</li>
                        <li><strong>‚ùå Don't</strong> log sensitive data (tokens, secrets)</li>
                        <li><strong>‚ùå Don't</strong> trust client-side validation alone</li>
                        <li><strong>‚ùå Don't</strong> expose stack traces in errors</li>
                    </ol>
                </div>
            </div>

            <div style="background: white; padding: 20px; border-radius: 6px; margin-top: 20px;">
                <h4 style="color: #8e44ad; margin-top: 0;">üéØ Security Testing Checklist</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 15px; font-size: 0.85em;">
                    <div>
                        <strong style="color: #e74c3c;">üî¥ Critical Tests:</strong>
                        <ul style="margin: 5px 0; padding-left: 20px;">
                            <li>Authorization code replay</li>
                            <li>Token signature tampering</li>
                            <li>CSRF attack simulation</li>
                            <li>Redirect URI manipulation</li>
                            <li>Scope escalation attempts</li>
                        </ul>
                    </div>
                    <div>
                        <strong style="color: #f39c12;">üü° Important Tests:</strong>
                        <ul style="margin: 5px 0; padding-left: 20px;">
                            <li>Token expiration validation</li>
                            <li>Refresh token rotation</li>
                            <li>Rate limit enforcement</li>
                            <li>CORS policy validation</li>
                            <li>Input sanitization</li>
                        </ul>
                    </div>
                    <div>
                        <strong style="color: #27ae60;">üü¢ Good to Have:</strong>
                        <ul style="margin: 5px 0; padding-left: 20px;">
                            <li>Session timeout testing</li>
                            <li>Concurrent session limits</li>
                            <li>Brute force protection</li>
                            <li>Security header validation</li>
                            <li>TLS configuration check</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <h3 style="color: #2c3e50; margin-bottom: 15px;">üìö Key Takeaways</h3>
            <div style="text-align: left; max-width: 900px; margin: 0 auto; background: #f8f9fa; padding: 25px; border-radius: 8px;">
                <p><strong>‚ö†Ô∏è OAuth 2.0 vs OIDC:</strong> OAuth 2.0 alone is ONLY for authorization (delegated access), NOT authentication. For "login" functionality, you need <strong>OIDC (OpenID Connect)</strong> which adds an authentication layer on top of OAuth 2.0.</p>
                <p><strong>SAML 2.0:</strong> Enterprise-grade SSO for workforce authentication. Heavy, XML-based, excellent for web apps with centralized identity management.</p>
                <p><strong>OIDC:</strong> Modern authentication + authorization. Lightweight, JSON-based, built on OAuth 2.0. Perfect for consumer apps, mobile apps, and APIs. Uses ID token for authentication and access token for authorization.</p>
                <p><strong>Hybrid (SAML + OAuth):</strong> üåü Best approach for enterprises with existing SAML infrastructure. SAML handles authentication (leveraging enterprise SSO), then OAuth tokens are issued for modern API authorization. This is how <strong>Identity Brokers, Atlassian, and Salesforce</strong> work.</p>
                <p><strong>Three Token Types in OIDC:</strong></p>
                <ul style="margin-left: 20px;">
                    <li><strong>ID Token (JWT):</strong> Proves WHO you are (authentication) üÜî</li>
                    <li><strong>Access Token:</strong> Grants WHAT you can access (authorization) üîë</li>
                    <li><strong>Refresh Token:</strong> Gets new tokens when they expire üîÑ</li>
                </ul>
                <p style="margin-top: 15px;"><strong>Identity Broker Pattern:</strong> Employee authenticates via SAML (Corporate Identity) ‚Üí IDbroker validates SAML assertion ‚Üí IDbroker issues OAuth access/refresh tokens ‚Üí Application uses Bearer token for all API calls ‚Üí No need to parse SAML for each API call ‚Üí Stateless microservices architecture.</p>
            </div>
            <p style="margin-top: 30px;"><strong>Examples Analyzed:</strong></p>
            <p>1. <strong>Atlassian Products (Confluence + Jira)</strong> - Enterprise workforce authentication with SAML 2.0 via Corporate Identity. Includes workspace and project access with production HAR trace examples.</p>
            <p>2. <strong>OIDC Authentication (Generic + HashiCorp Vault)</strong> - Modern authentication using OpenID Connect (OAuth 2.0 + authentication layer). Includes: (a) Generic OIDC callback pattern (xmy.com), (b) HashiCorp Vault secrets management (vault.company.com) with Duo Security SSO, 6-day Vault tokens, namespace-based access control, and policy-based authorization.</p>
            <p>3. <strong>Identity Broker Hybrid Pattern + Real HAR Data</strong> - SAML authentication ‚Üí OAuth token issuance with production data from enterprise applications (18-hour tokens, 16+ scopes, 227ms latency)</p>
            <p>4. <strong>OAuth Client Credentials Grant</strong> - Machine-to-machine service authentication with no user context (webexsquare:admin, Identity:SCIM, 1-hour stateless tokens)</p>
            <p>Generated: January 21, 2026</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            sequence: {
                diagramMarginX: 50,
                diagramMarginY: 10,
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35,
                mirrorActors: true,
                useMaxWidth: true
            }
        });
    </script>
</body>
</html>
